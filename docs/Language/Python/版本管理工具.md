# 版本管理工具

## Python版本管理工具

类似于 Nodejs 中的 NVM 用于管理多个 nodejs 版本, Python 也有类似的 Python 版本管理工具

---

### pyenv

> [GitHub - pyenv/pyenv: Simple Python version management](https://github.com/pyenv/pyenv)

pyenv 可让您轻松地在多个 Python 版本之间切换。它简单、不引人注目，并且遵循 UNIX 单一用途工具只做好一件事的传统。

pyenv 使用注入到`PATH`中的 shim 可执行文件拦截 Python 命令，确定应用程序指定的 Python 版本，并将命令传递到正确的 Python 安装。

更详细的信息请参阅 [GitHub - pyenv/pyenv: Simple Python version management](https://github.com/pyenv/pyenv)

---

#### 安装

:::tabs

@tab:active UNIX/MacOS

```bash
# 如果需要的话可以设置下 https 代理, 例如:
export http_proxy="http://127.0.0.1:7890"
export https_proxy="http://127.0.0.1:7890"
# 安装 pyenv
curl https://pyenv.run | bash
```

![image-20240731170648771](http://cdn.ayusummer233.top/DailyNotes/202407311706846.png)

![image-20240731170700389](http://cdn.ayusummer233.top/DailyNotes/202407311707443.png)

根据输出提示中所说的那样, 如果你用的是 bash 那就在 `~/.bashrc` 中添加如下命令, 如果用的是 `zsh` 则在 `~/.zshrc` 中添加如下命令, 其他 shell 同理

```bash
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"
```

有关更多详细信息，可以参阅此项目组的其他项目： [GitHub - pyenv/pyenv-installer: This tool is used to install `pyenv` and friends.](https://github.com/pyenv/pyenv-installer)

---

@tab Windows

Pyenv 并不正式支持 Windows，并且无法在适用于 Linux 的 Windows 子系统之外的 Windows 中工作。此外，即使在 `Windows Subsystem for Linux` 中, 它安装的 Python 也不是 `native Windows` 版本，而是在虚拟机中运行的 Linux 版本 - 因此您将无法获得 Windows 特定的功能。

如果使用的是 Windows，建议使用 @kirankotari 的[`pyenv-win`](https://github.com/pyenv-win/pyenv-win)分支——它会安装本机 Windows Python 版本。

:::

---

#### 使用

这里只讨论 Linux 下的 pyenv 的使用

首先需要把一些基础的 Python 构建工具库安装一下

```bash
sudo apt-get update
sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python3-openssl git
```

安装并切换到指定 Python 版本, 例如:

```bash
# 安装 python3.10.4
pyenv install python3.10.4
# 为全局激活 python3.10.4
pyenv global python3.10.4
# 每当您位于当前目录（或其子目录）时自动选择
pyenv local python3.10.4
# 仅选择当前 shell 会话
pyenv shell python3.10.4
```

![image-20240731182322273](http://cdn.ayusummer233.top/DailyNotes/202407311823350.png)

---

### conda

> [Getting started with conda — conda 24.7.2.dev10 documentation](https://conda.io/projects/conda/en/latest/user-guide/getting-started.html)

**Conda 是一个开源的包管理和环境管理系统**，它能够运行、安装和更新各种包和依赖，包括 Python 和非 Python 包。Conda 适用于 Windows、macOS 和 Linux 系统。

我们可以通过安装 conda 发行版来使用 conda, 常见的 conda 发行版主要是 miniconda 和 anaconda

---

### miniconda

> [Miniconda — Anaconda documentation](https://docs.anaconda.com/miniconda/)

Miniconda 是 conda 的免费最小安装程序。它是 Anaconda 的一个小型引导版本，仅包含 conda、Python、它们所依赖的包以及少量其他有用的包（例如 pip、zlib 等）。如果您需要更多软件包，请使用`conda install`命令从 Anaconda 公共存储库或其他渠道（例如 conda-forge 或 bioconda）默认提供的数千个软件包中进行安装。

先看下 [系统要求 — Anaconda 文档 --- System requirements — Anaconda documentation](https://docs.anaconda.com/miniconda/miniconda-system-requirements/) 确认当前机器是否支持安装 miniconda

如果支持的话则根据 [Miniconda — Anaconda documentation](https://docs.anaconda.com/miniconda/) 进行安装即可

---

#### Anaconda

> [anaconda.com/download](https://www.anaconda.com/download)

Anaconda Distribution 是一个功能齐全的安装程序，附带一套用于数据科学的软件包，以及 Anaconda Navigator（一个用于 conda 环境的 GUI 应用程序）。

---

##### 安装

----

:::tabs

@tab:active Windows


> > [bpo-42627: Fix wrong parsing of Windows registry proxy settings by CrazyBoyFeng · Pull Request #26307 · python/cpython · GitHub](https://github.com/python/cpython/pull/26307)
>
> 需要注意的是, 如果使用 Clash 的话需要可以打开此配置
>
> ![image-20240731154928528](http://cdn.ayusummer233.top/DailyNotes/202407311549040.png)
>
> 否则使用 Anaconda Navigator 或者 conda 环境操作时会报错
>

[安装包](https://ayusummer-my.sharepoint.com/:f:/g/personal/233_ayusummer_onmicrosoft_com/EhGEGFxHsINMtuhCpcUlQtUBRflV21xfYIkwpbeF2-d8IQ?e=Inh6dl)

> [Anaconda 官网](https://www.anaconda.com/products/individual)  
> 可在此处获取其他版本的安装包

> 需要注意的是 Anaconda 装完之后打开命令行总会自动进入 conda 环境, 可以通过更改 conda 配置来取消自动进入
>
> ```bash
> conda config --set auto_activate_base false
> ```
>
> 如果想要设置自动进入的话将 `false` 改为 `true` 运行即可

安装完成后打开 `Anaconda Navigator`:

![image-20220523093633147](http://cdn.ayusummer233.top/img/202205230936469.png)

---

@tab Linux


> [如何在 Ubuntu 20.04 上安装 Anaconda - 云+社区 - 腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/1649008)  
> [Anaconda conda常用命令：从入门到精通_chenxy_bwave的专栏-CSDN博客_conda常用命令](https://blog.csdn.net/chenxy_bwave/article/details/119996001)
>
> ---
>
> 可在 [Anaconda 官网](https://www.anaconda.com/products/individual) 获取其他版本的安装包

```sh
# 安装 Anaconda
#wget https://repo.anaconda.com/archive/Anaconda3-2021.11-Linux-x86_64.sh
#bash Anaconda3-2021.11-Linux-x86_64.sh
wget https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-x86_64.sh
bash Anaconda3-2022.05-Linux-x86_64.sh
```

> ![20211219065157](http://cdn.ayusummer233.top/img/20211219065157.png)
>
> 若出现 `段错误 (核心已转储)` 字样, 可以使用
>
> ```bash
> wget https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-x86_64.sh
> ```
>
> 从断点处继续下载

长按 ENTER 阅读完条款

![20211219065309](http://cdn.ayusummer233.top/img/20211219065309.png)

yes

![20211219065431](http://cdn.ayusummer233.top/img/20211219065431.png)

选择安装路径, 默认为 `/root/anaconda3`, 这个过程会比较长

![20211219065943](http://cdn.ayusummer233.top/img/20211219065943.png)

yes, 执行初始化, 这将会将命令行工具 conda 添加到系统的 PATH 环境变量中。  
不过想要激活 Anaconda，还需要关闭并且重新打开你的 shell 或者在当前 shell 会话中输入下面的命令，来重新加载 PATH 环境变量：   
```shell
source ~/.bashrc
```

可以使用 `conda --version` 查看 Anaconda 版本

![20211219070617](http://cdn.ayusummer233.top/img/20211219070617.png)

设置国内镜像

```shell
#设置清华镜像
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/
#设置bioconda
conda config --add channels bioconda
conda config --add channels conda-forge
#设置搜索时显示通道地址
conda config --set show_channel_urls yes
```


:::

---

##### 配置

`Anaconda` 安装完成后调起命令行会默认启动 conda 环境, 可以使用如下命令开启或关闭该项配置

```bash
# 关闭自动启动conda环境
conda config --set auto_activate_base false
# 启动自动启动conda环境
conda config --set auto_activate_base true
```

---

##### 创建与使用 python 环境

###### 使用 Anaconda Navigator

打开 `Anaconda Navigator -> Environments` 在环境列表底部按钮中找到 `Create` 并点击

![image-20220517153334579](http://cdn.ayusummer233.top/img/202205171533981.png)

为新环境命一个名(英文命名, 尽量简短些, 之后激活要用)

> 选择 Python 环境可以保守些, 比如最新版本回退一两个大版本这样的, 主要是因为有一些三方库更新没跟上, 不一定支持最新版本

![image-20220517153442365](http://cdn.ayusummer233.top/img/202205171534732.png)

在命令行中使用 conda 环境可以使用如下指令激活:

```bash
conda activate 环境名
```

![image-20220517153733464](http://cdn.ayusummer233.top/img/202205171537691.png)


---

###### 使用命令行

创建一个名为 `BigData`, python 版本为 3.9 的虚拟环境

```shell
conda create -n BigData python=3.9
```

激活 `BigData` conda 环境

```shell
conda activate BigData
```

![20211219072053](http://cdn.ayusummer233.top/img/202208031558796.png)

退出当前虚拟环境
```shell
conda deactivate
```

> [Conda clean 净化Anaconda - 简书 (jianshu.com)](https://www.jianshu.com/p/f14ac62bef99)  
> [Anaconda conda常用命令：从入门到精通_chenxy_bwave的专栏-CSDN博客_conda常用命令](https://blog.csdn.net/chenxy_bwave/article/details/119996001)  
> [Anaconda 官网](https://www.anaconda.com/products/individual)  
> 可在此处获取其他版本的安装包


---

##### Anaconda 换源

> [anaconda修改国内源 - 余者皆可 - 博客园 (cnblogs.com)](https://www.cnblogs.com/yuvejxke/p/13169172.html)
>
> [Anaconda 换国内源_scl52tg的博客-CSDN博客_conda 换源](https://blog.csdn.net/scl52tg/article/details/120959893)

- 打开 `anaconda prompt`   
  ![20220113131937](http://cdn.ayusummer233.top/img/20220113131937.png)  
  ![20220113132007](http://cdn.ayusummer233.top/img/20220113132007.png)

- 执行以下命令来配置清华源：

  > 不打开 navigator 也是完全可行的, 打开命令行就可以了, 前提是为 anaconda 配置了环境变量
  >
  > 只要在命令行中 `conda -V` 有版本号输出就可以了
  
  ```shell
  conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/
  conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge
  conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
  conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/
  conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
  conda config --set show_channel_urls yes
  ```
  
  配置清华源是为了后续使用 `pip` 命令安装 python 库时快些, 不配置换源而直接使用默认源的话在墙内容易超时报错
  
  > 中科大源:
  >
  > ```bash
  > conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/main/
  > conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/
  > conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/
  > conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/msys2/
  > conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/bioconda/
  > conda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/menpo/
  > conda config --set show_channel_urls yes
  > 
  > ```
  
  > 需要注意的是 conda 换源后会使更新 conda 的操作可能会报错
  >
  > 因此在更新 conda 的时候记得回复默认源
  >
  > ```bash
  > conda config --remove-key channels
  > ```
  >
  > 查看源:
  >
  > ```bash
  > conda config --show
  > ```
  >
  > ![image-20220804012242625](http://cdn.ayusummer233.top/img/202208040122840.png)

---

##### Anaconda Navigator 升级

```bash
conda update conda -y
conda update anaconda -y
conda update anaconda-navigator -y
```

> 如果进行了换源操作记得在升级前恢复默认源, 否则可能会在镜像源中找不到更新包
>
> ```bash
> conda config --remove-key channels
> ```

---

##### 报错收集

###### check_hostname requires server_hostname


- 本来是在 `Pycharm` 中新建 `conda` 环境报的错误,接着打开 `Anaconda Navigator` 也报了相同的错误
- 最终在[anaconda-issues #12410](https://github.com/ContinuumIO/anaconda-issues/issues/12410)找到的相同报错及解决方案为 **关掉VPN**

对于 Clash 而言可以打开此项配置

![image-20230719000029091](http://cdn.ayusummer233.top/DailyNotes/202307281210626.png)

> [bpo-42627: Fix wrong parsing of Windows registry proxy settings by CrazyBoyFeng · Pull Request #26307 · python/cpython · GitHubopen in new window](https://github.com/python/cpython/pull/26307)

开了之后就正常了:

![image-20230719000057721](http://cdn.ayusummer233.top/DailyNotes/202307281210111.png)

---

###### 各类 `HTTPError` 相关

我这边报错都是清华的源报错,换成阿里的源就没问题了(

- `https://mirrors.aliyun.com/anaconda/pkgs/main/`

  ![20210522090710](http://cdn.ayusummer233.top/img/20210522090710.png)

---

###### `ModuleNotFoundError: No module named 'pip._vendor....'`

- `pip` 出问题了
- 在 `CMD.exe Prompt` 中执行 `conda update pip` 即可

---



