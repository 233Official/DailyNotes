# s2-045内存马

> [S2-045 写入内存马 - ccadmin - 博客园 (cnblogs.com)](https://www.cnblogs.com/tide-sec/p/16304736.html)
>
> [s2-045真正一键getshell菜刀马-突破任何限制 | pirogue](http://pirogue.org/2017/03/09/s2-045真正一键getshell菜刀马-突破任何限制/)

---

## 漏洞概述

- 漏洞编号: CVE-2017-5638 Struts2远程代码执行漏洞
- 漏洞类型: 远程代码执行漏洞
- 危险等级: 高危
- 利用条件: Struts2在受影响版本内，并包含Commons-FileUpload、Commons-IO库
- 受影响版本: Struts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10

Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。

Struts2在受影响版本内，并包含Commons-FileUpload、Commons-IO库时, 该漏洞能够通过构造恶意的 Content-Type 值来执行任意代码。 如果 Content-Type 值无效，则会抛出异常，并向用户显示错误消息，从而能够进一步获取服务器权限。

- 安装官方补丁升级到最新版本: Struts 2.3.32 or Struts 2.5.10.1
- 临时修复方法: Struts2 默认使用 Jakarta 的 Common-FileUpload 文件上传解析器, 修改上传解析器为cos或pell。

---

## GetShell

原理是将菜刀一句话进行拆分为6个任意后缀文件，urlencod编码，在写入文件的时候将脚本decode写入web根目录；最后再写入第7个jsp脚本，此脚本内容include前面6个文件，即可实现生成一句话菜刀连接马；



















