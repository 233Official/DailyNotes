<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.27" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="alternate" type="application/atom+xml" href="https://233official.github.io/dailynotes/atom.xml" title="DailyNotes Atom Feed"><link rel="alternate" type="application/json" href="https://233official.github.io/dailynotes/feed.json" title="DailyNotes JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://233official.github.io/dailynotes/rss.xml" title="DailyNotes RSS Feed"><title>CH11.测试 | DailyNotes</title><meta name="description" content="233的日常学习记录">
    <link rel="preload" href="/dailynotes/assets/style-CGj8zUtE.css" as="style"><link rel="stylesheet" href="/dailynotes/assets/style-CGj8zUtE.css">
    <link rel="modulepreload" href="/dailynotes/assets/app-BT-bWAve.js"><link rel="modulepreload" href="/dailynotes/assets/CH11-测试.html-Di_0Amu2.js"><link rel="modulepreload" href="/dailynotes/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/dailynotes/assets/index.html-31BuZB7f.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TODOLIST.html-Bgyd-t9c.js" as="script"><link rel="prefetch" href="/dailynotes/assets/统括.html-CCsA-krN.js" as="script"><link rel="prefetch" href="/dailynotes/assets/DailyLife.html-at5PVuQj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Proxy.html-BnBqS5sx.js" as="script"><link rel="prefetch" href="/dailynotes/assets/生活.html-hVmIOOx2.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Gitee.html-Be77ucFZ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Github.html-Zud1a4hc.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Gitlab.html-JCWWA2dV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DHycjfl0.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Markdown.html-D6wQvqj2.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Mermaid.html-Dk-qOwgd.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Notion.html-DWgHO45l.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PlantUML.html-C58z4Q07.js" as="script"><link rel="prefetch" href="/dailynotes/assets/VitePress.html-DUvX0_0E.js" as="script"><link rel="prefetch" href="/dailynotes/assets/VuePress.html-DRVRWedu.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Word.html-jeMDvHtw.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CSS.html-C6yfz-qR.js" as="script"><link rel="prefetch" href="/dailynotes/assets/HTML.html-C3tULeMP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Nginx.html-DqSzmUy5.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Nodejs.html-C7jVoiwZ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/通识.html-m6ncePXw.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BdhBa8Bc.js" as="script"><link rel="prefetch" href="/dailynotes/assets/前后端交互数据的编码方案.html-8SyJ4hgA.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C73Lpkgl.js" as="script"><link rel="prefetch" href="/dailynotes/assets/kali.html-DHDR2Fd0.js" as="script"><link rel="prefetch" href="/dailynotes/assets/抓包发包.html-CWmN25vj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/编码.html-DIV8Wp-7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/VSCode.html-Cno-jbm9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Windows.html-pNfN9bYI.js" as="script"><link rel="prefetch" href="/dailynotes/assets/外设.html-B-Z0W4So.js" as="script"><link rel="prefetch" href="/dailynotes/assets/换源.html-DB9Jfuun.js" as="script"><link rel="prefetch" href="/dailynotes/assets/渐构-断墨寻径.html-BsrcAcF_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/通识.html-BFUCZfUN.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BAJSS6Qx.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CPP.html-Dgcutqgv.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BHx_zqBF.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Java.html-mojqS3Ii.js" as="script"><link rel="prefetch" href="/dailynotes/assets/JavaWeb.html-DdLVzgno.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Java代码审计.html-BhTQ3CXB.js" as="script"><link rel="prefetch" href="/dailynotes/assets/JavaScript.html-BI3rNAQM.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PHP学习.html-DOmSA9hK.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PHP安全.html-5iqpUKcG.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Note-python.html-DAdO5jEe.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PEP8.html-c5vY8hk3.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PythonWeb.html-B6N-bbRg.js" as="script"><link rel="prefetch" href="/dailynotes/assets/QuickStart.html-Bny7VIGY.js" as="script"><link rel="prefetch" href="/dailynotes/assets/开发环境.html-QsQy_sAh.js" as="script"><link rel="prefetch" href="/dailynotes/assets/版本管理工具.html-06qY04TB.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TypeScript.html-D9hHxu9z.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D_7v4RgF.js" as="script"><link rel="prefetch" href="/dailynotes/assets/资源和URI.html-3yljkkTM.js" as="script"><link rel="prefetch" href="/dailynotes/assets/FantasticAdmin.html-xcp2D9jV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Vben.html-DQhqLUGO.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Vue.html-TNOa_fl9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/vue-admin-template.html-BXFU-cpS.js" as="script"><link rel="prefetch" href="/dailynotes/assets/JSON兼容.html-C6oUzeX5.js" as="script"><link rel="prefetch" href="/dailynotes/assets/OAuth2.0授权模式.html-rerfu_X4.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Pydantic.html-CcovBZy6.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BawkWkOE.js" as="script"><link rel="prefetch" href="/dailynotes/assets/中间件.html-BG-qt5IU.js" as="script"><link rel="prefetch" href="/dailynotes/assets/依赖注入.html-B9AGM8oU.js" as="script"><link rel="prefetch" href="/dailynotes/assets/后台任务.html-cVhXEVH_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/响应模型.html-CdJaMq_9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/数据库操作.html-HCilF5gX.js" as="script"><link rel="prefetch" href="/dailynotes/assets/测试用例.html-C7J_M3Kj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/请求模型.html-DsP22IZA.js" as="script"><link rel="prefetch" href="/dailynotes/assets/跨域资源共享.html-BpmN1L-D.js" as="script"><link rel="prefetch" href="/dailynotes/assets/高级用户指南.html-MibUPuqc.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Flask.html-D6HwKfhA.js" as="script"><link rel="prefetch" href="/dailynotes/assets/MySQL.html-CDwrrYy-.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PostgreSQL.html-DBiceUsT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Redis.html-j-UmhkLC.js" as="script"><link rel="prefetch" href="/dailynotes/assets/SQLAlchemy.html-wJrN8v0J.js" as="script"><link rel="prefetch" href="/dailynotes/assets/SQLite.html-DeystpJJ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/数据库.html-IIael49U.js" as="script"><link rel="prefetch" href="/dailynotes/assets/commonNotes.html-CIG0iK11.js" as="script"><link rel="prefetch" href="/dailynotes/assets/gypsum.html-DOcMbleP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DF7TLH_X.js" as="script"><link rel="prefetch" href="/dailynotes/assets/云崽.html-DoPEJC5-.js" as="script"><link rel="prefetch" href="/dailynotes/assets/企微Bot.html-DrmZfUcK.js" as="script"><link rel="prefetch" href="/dailynotes/assets/频道Bot.html-pVlVK81V.js" as="script"><link rel="prefetch" href="/dailynotes/assets/sovits_32k.html-zDydCdsH.js" as="script"><link rel="prefetch" href="/dailynotes/assets/sovits_4.html-D3TNx0c9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/大数据随笔.html-B9gZCO5Z.js" as="script"><link rel="prefetch" href="/dailynotes/assets/导论.html-BEJJoi5o.js" as="script"><link rel="prefetch" href="/dailynotes/assets/微信小程序.html-c-iyEXX7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/MOOC_测试与作业.html-96TbqMV_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/MachineLearning.html-B1IkpiC4.js" as="script"><link rel="prefetch" href="/dailynotes/assets/机器学习.html-DuTRkbMm.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TA0001-InitialAccess.html-Cph429fj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TA0005-DefenseEvasion(下).html-kfeHhOIW.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TA0040-Impact.html-BS2qOoDu.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-V1ne1PcD.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-Bfzk-c7X.js" as="script"><link rel="prefetch" href="/dailynotes/assets/MSFConsole.html-BEZ9cYFI.js" as="script"><link rel="prefetch" href="/dailynotes/assets/MSFVenom.html-D4VmNy0M.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D81iZ2nP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CYNYEeRw.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-PLOh_SiO.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BpDdvfdd.js" as="script"><link rel="prefetch" href="/dailynotes/assets/HMAC.html-CAiquVel.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Hash.html-CDFGMBLK.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-qK8S8Gxu.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-vBodPhaQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D5Py6AyK.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-1XEs4NoK.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Docker.html-M_2iC18q.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Harbor.html-Cn2RGUGB.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Linux服务器.html-BmAhwL32.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Linux软件管理.html-0Lx8Ls9g.js" as="script"><link rel="prefetch" href="/dailynotes/assets/SSH.html-B0sACgi9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Shell.html-CLw8jkFi.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-zFxBKUbh.js" as="script"><link rel="prefetch" href="/dailynotes/assets/会话管理工具.html-DhtGVPC5.js" as="script"><link rel="prefetch" href="/dailynotes/assets/网络配置.html-2LfltJWI.js" as="script"><link rel="prefetch" href="/dailynotes/assets/订阅更新.html-DwnZLcH_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/C.html-CbU4xZRL.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH1-入门.html-eECn4aX8.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH10-包和工具.html-DK-72ajq.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH12-反射.html-BKFcEHGl.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH2-程序结构.html-BZ0KjTWQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH3-基础数据类型.html-Df8eqR89.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH4-复合数据类型.html-uUJ1nhOF.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH5-函数.html-DpdkHOqq.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH6-方法.html-CXJKM67b.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH7-接口.html-DgRdCdgt.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH8-Goroutines和Channels.html-DIFp9Qmz.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CH9-基于共享变量的并发.html-Dn_EAhoQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/QA.html-Dc-iZVWI.js" as="script"><link rel="prefetch" href="/dailynotes/assets/提纲.html-5borzoVf.js" as="script"><link rel="prefetch" href="/dailynotes/assets/命令执行.html-iiphXJxF.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CxjEUGi-.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CutZcbBv.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BnMjaLQU.js" as="script"><link rel="prefetch" href="/dailynotes/assets/API.html-Dry70bsk.js" as="script"><link rel="prefetch" href="/dailynotes/assets/AnimateCSS.html-BaSTsflx.js" as="script"><link rel="prefetch" href="/dailynotes/assets/ESLint.html-Bi2HUPeM.js" as="script"><link rel="prefetch" href="/dailynotes/assets/ElementPlus.html-CDvyuYus.js" as="script"><link rel="prefetch" href="/dailynotes/assets/GreenSock.html-C5vSIjuC.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Less.html-CR6fWQmh.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Lodash.html-Criwn_JP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/MicrosoftLearn.html-CWDdhIhS.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Pinia.html-BKXakvIC.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Router.html-BJy9WMXV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Scoped与样式穿透.html-Bde3dk9y.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TSX.html-Bx6tnjtD.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Vite.html-CB3GeaM_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/VueUse.html-DEd5y09M.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Vuex.html-BFOnuR-a.js" as="script"><link rel="prefetch" href="/dailynotes/assets/auto-import.html-DvPcw4Ez.js" as="script"><link rel="prefetch" href="/dailynotes/assets/可复用组合.html-Bm9tCByn.js" as="script"><link rel="prefetch" href="/dailynotes/assets/安装.html-whHppdXz.js" as="script"><link rel="prefetch" href="/dailynotes/assets/工具.html-C2Pzb5yu.js" as="script"><link rel="prefetch" href="/dailynotes/assets/简介.html-C1841RMi.js" as="script"><link rel="prefetch" href="/dailynotes/assets/组件系统.html-DxSvIlv5.js" as="script"><link rel="prefetch" href="/dailynotes/assets/自定义全局插件.html-l6TECIBT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/LeetCodeNote.html-D5vm953-.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BDnvW32Y.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BahLieki.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DY0ArPG5.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C-pZDayL.js" as="script"><link rel="prefetch" href="/dailynotes/assets/BurpSuite.html-iUOLOu8F.js" as="script"><link rel="prefetch" href="/dailynotes/assets/msf.html-BZ1-1zCj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/AWVS.html-LRVD7Y_w.js" as="script"><link rel="prefetch" href="/dailynotes/assets/nmap.html-CHAKd3TP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Powershell-Empire.html-Igm1GXLi.js" as="script"><link rel="prefetch" href="/dailynotes/assets/NATBypass.html-DDY_xWgs.js" as="script"><link rel="prefetch" href="/dailynotes/assets/SSH隧道.html-CGlAZfGr.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DetYRgTj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Linux.html-w1Ge9RdA.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-t0Zz8tvY.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Linux.html-C0-xrRpb.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Windows.html-CQOgXZm7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D8KtNIQA.js" as="script"><link rel="prefetch" href="/dailynotes/assets/SSH横向移动.html-DAY4830g.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Vectr.html-niZE2Jro.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BQkcYQ1B.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BWIwbxoT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DYkPlZLb.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-B69UOJ9C.js" as="script"><link rel="prefetch" href="/dailynotes/assets/从基础的RAT出发梳理一些常见的查杀与免杀技术.html-DFi0Rd0I.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Windows对象与句柄.html-DPm7dLca.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C4EkixWx.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BV2rtqTr.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C-Y_GxQB.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-0DJIlWTQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-B8_66NsP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/名词解释.html-CkuHZwP7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Exchange.html-dys2l6Fl.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Outlook.html-Du1kPFPZ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CVtdPmjC.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CzPseujI.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C4zMuKJv.js" as="script"><link rel="prefetch" href="/dailynotes/assets/WSL2.html-h-pE1o4l.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Matplotlib.html-BHqTe_Be.js" as="script"><link rel="prefetch" href="/dailynotes/assets/OpenCV-python.html-DjhUOqr7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Pandas.html-DRXna3li.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Pillow.html-BTjVuxzP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/PyPSRP.html-LurzDGJ2.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-UI-CMlfP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/TensorFlow.html-BZN9FksL.js" as="script"><link rel="prefetch" href="/dailynotes/assets/异步编程.html-DJ9nfHhJ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/json.html-DuwglMBy.js" as="script"><link rel="prefetch" href="/dailynotes/assets/numpy.html-BLZqGzoT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/turtle.html--Sq6Cz3r.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CqaRqjnL.js" as="script"><link rel="prefetch" href="/dailynotes/assets/T1053.002-AT.html-OM7-MeS2.js" as="script"><link rel="prefetch" href="/dailynotes/assets/冰蝎.html-DJj2BZPX.js" as="script"><link rel="prefetch" href="/dailynotes/assets/菜刀.html-CqPIksLe.js" as="script"><link rel="prefetch" href="/dailynotes/assets/蚁剑.html-DXZAFV4C.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C7KVYeqj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-cx6BB8MQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Jetty内存马.html-CWVUnKUC.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-fC9a0lsV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/HTTP请求走私.html-BHNVNf0V.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BeKLAllT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BiA7wJgi.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BU_Z2RY1.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DHo-IL-m.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BX4bz3Uo.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-xH-GBmJA.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BTqGonmt.js" as="script"><link rel="prefetch" href="/dailynotes/assets/AMSI.html-F-Uity1Z.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BDIaF45k.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-Dm0nmvU8.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CX4gMd_x.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BTTG_haq.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-YdM-gCe7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CCOxA8er.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D74-Bc5D.js" as="script"><link rel="prefetch" href="/dailynotes/assets/NTFS文件流隐藏的可执行文件.html-B13kna0a.js" as="script"><link rel="prefetch" href="/dailynotes/assets/捆绑程序.html-DaMZmDEP.js" as="script"><link rel="prefetch" href="/dailynotes/assets/文件名混淆.html-BcFdXRwx.js" as="script"><link rel="prefetch" href="/dailynotes/assets/白加黑.html-sLLExkhg.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2018-20250WinRAR目录穿越漏洞.html-CsjCo9Il.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2023-38831-Winrar代码执行漏洞.html-Ax2-xQ47.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DJpIE-gf.js" as="script"><link rel="prefetch" href="/dailynotes/assets/s2-045内存马.html-tyxb3Vyr.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CW8Q_wTY.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-Csb5AOWR.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-e4ehmHn2.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C8mrEoyG.js" as="script"><link rel="prefetch" href="/dailynotes/assets/Excel4.0宏.html-BkCQQjuW.js" as="script"><link rel="prefetch" href="/dailynotes/assets/VBA宏.html-BE2JVLcE.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2017-0199.html-HCpW4m_J.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2017-11882.html-CGzd-pYH.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2017-8570.html-B-rQG5Bf.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2017-8759.html-B2mk9Gbj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2017-8759_WSDL解析器代码注入.html-8QJvlSjT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2018-0802.html-B-kBQ_18.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2018-4993-AdobeAcrobat.html-BALtk_PM.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2018-8420.html-DPjaEssI.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2021-40444_Microsoft-Office-Word-MSHTML-RCE.html-BWy-4gwW.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2022-30190.html-jxhUCuTV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2022-30190_Follina-Office-MSDT-RCE.html-BvvnQ0E1.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2023-21716.html-qOhEaE8Y.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2023-38831-WinRAR代码执行漏洞.html-D5lfHlPg.js" as="script"><link rel="prefetch" href="/dailynotes/assets/模板.html-DOfUM_PS.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BSwqZVCa.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DT9QJmiF.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D3PLGf4I.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BnwPvTEi.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2018-4993.html-DdZ7mf01.js" as="script"><link rel="prefetch" href="/dailynotes/assets/servletContext-addFilter.html-BV7pjwFq.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DJ3duWPR.js" as="script"><link rel="prefetch" href="/dailynotes/assets/servletContext-addServlet.html-CwRAXXri.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-FwAHn17f.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CBgQAiwd.js" as="script"><link rel="prefetch" href="/dailynotes/assets/CVE-2017-8570.html-BPqibR7u.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D7ZOFvoW.js" as="script"><link rel="prefetch" href="/dailynotes/assets/404.html-D9z5GOKo.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-ClTYs0nh.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DqQFt2GT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CZsPIcfQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DpbOyzTk.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CQLiBzSZ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-vGVincYl.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D9rnMfGV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BOuK0FiN.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-md2n9YKS.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BAt0l5Nt.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C9EVTnEc.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-B5k5GU-9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CADWXCeG.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BqGUF8Sl.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D4D9axgc.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-8V98kQPY.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DUm8yRc_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DOd8hlSb.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-D16sv9Qy.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-AdauUTu7.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DHbbDWjK.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BLl_cwDC.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DkEuyxpx.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-B3riCgMj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CGZ1SQY8.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CE2iP-7R.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DMRAguNz.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DEhLhcnX.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-B57QofsG.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-10GcLAd5.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CskPKQGQ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-82ikTwSE.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DXhIxorH.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C7DwEqfL.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BfKGQ2sM.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BC1PjbMk.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CyiEkjal.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BRvX2_zJ.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DRW-UWCb.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DsDwoGR3.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BnfyrHlT.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DVu5qd_s.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-B8syU-UB.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CIft5mXp.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DkwgtVCq.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CrNiXVTz.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-Bly05fGn.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-9E2I-UT8.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CMPqT-uS.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-xjiRJADf.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BIgH1KcW.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BlUE6OO-.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-_xnA_h_M.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BTyVmls4.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-DRAPSDXj.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CwPOGDle.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-Bhg4NBdr.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CNnFJHlE.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CFqcnZZV.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BIlLxkUO.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-oB8ipEn9.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-C0TNOpj1.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-BioNBct3.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CPv0YMLG.js" as="script"><link rel="prefetch" href="/dailynotes/assets/index.html-CLq0zUz_.js" as="script"><link rel="prefetch" href="/dailynotes/assets/mermaid.core-CfT3QQ9J.js" as="script"><link rel="prefetch" href="/dailynotes/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/dailynotes/assets/SearchResult-DnUmkkd9.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/dailynotes/"><img class="vp-nav-logo" src="/dailynotes/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">DailyNotes</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="笔记工具"><span class="title"><!---->笔记工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/NoteTools/VuePress.html" aria-label="VuePress"><!---->VuePress<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/NoteTools/Markdown.html" aria-label="Markdown"><!---->Markdown<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/NoteTools/Mermaid.html" aria-label="Mermaid"><!---->Mermaid<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/NoteTools/LaTex/" aria-label="LaTeX"><!---->LaTeX<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/NoteTools/PlantUML.html" aria-label="PlantUML"><!---->PlantUML<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/NoteTools/VitePress.html" aria-label="VitePress"><!---->VitePress<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="通识"><span class="title"><!---->通识</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/%E9%80%9A%E8%AF%86.html" aria-label="通识"><!---->通识<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/Linux/" aria-label="Linux"><!---->Linux<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/Windows.html" aria-label="Windows"><!---->Windows<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/Docker/Docker.html" aria-label="Docker"><!---->Docker<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/%E6%8D%A2%E6%BA%90.html" aria-label="换源"><!---->换源<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/%E5%A4%96%E8%AE%BE.html" aria-label="外设"><!---->外设<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/VSCode.html" aria-label="VSCode"><!---->VSCode<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/%E9%80%9A%E4%BF%A1/%E8%AE%A2%E9%98%85%E6%9B%B4%E6%96%B0.html" aria-label="通信"><!---->通信<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E9%80%9A%E8%AF%86/%E6%B8%90%E6%9E%84-%E6%96%AD%E5%A2%A8%E5%AF%BB%E5%BE%84.html" aria-label="渐构"><!---->渐构<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="日常"><span class="title"><!---->日常</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/DailyLife/DailyLife.html" aria-label="日常"><!---->日常<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/DailyLife/%E9%A3%9F%E8%B0%B1/" aria-label="食谱"><!---->食谱<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="网络安全"><span class="title"><!---->网络安全</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" aria-label="网络安全"><!---->网络安全<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%92%93%E9%B1%BC/" aria-label="钓鱼"><!---->钓鱼<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/kali.html" aria-label="kali"><!---->kali<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E7%BC%96%E7%A0%81.html" aria-label="编码"><!---->编码<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%8A%93%E5%8C%85%E5%8F%91%E5%8C%85.html" aria-label="抓包发包"><!---->抓包发包<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ATTCK/" aria-label="ATTCK"><!---->ATTCK<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/nmap.html" aria-label="信息收集"><!---->信息收集<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web%E5%AE%89%E5%85%A8/" aria-label="Web安全"><!---->Web安全<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E7%AB%AF%E7%82%B9%E5%AE%89%E5%85%A8/" aria-label="端点安全"><!---->端点安全<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" aria-label="内网渗透"><!---->内网渗透<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" aria-label="加密算法"><!---->加密算法<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Language"><span class="title"><!---->Language</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/Python/QuickStart.html" aria-label="Python"><!---->Python<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/CPlusPlus/CPP.html" aria-label="C++"><!---->C++<!----></a></li><li class="dropdown-item"><a class="route-link nav-link active" href="/dailynotes/Language/Go/" aria-label="Go"><!---->Go<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/JavaScript/JavaScript.html" aria-label="JavaScript"><!---->JavaScript<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/TypeScript/TypeScript.html" aria-label="TypeScript"><!---->TypeScript<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/Java/Java.html" aria-label="Java"><!---->Java<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/PHP/PHP%E5%AD%A6%E4%B9%A0.html" aria-label="PHP"><!---->PHP<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Language/Shell/Shell/" aria-label="Shell"><!---->Shell<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="后端"><span class="title"><!---->后端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%90%8E%E7%AB%AF/" aria-label="后端"><!---->后端<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%90%8E%E7%AB%AF/FastAPI/" aria-label="FastAPI"><!---->FastAPI<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%90%8E%E7%AB%AF/Flask/Flask.html" aria-label="Flask"><!---->Flask<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93.html" aria-label="数据库"><!---->数据库<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="前端"><span class="title"><!---->前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/%E9%80%9A%E8%AF%86.html" aria-label="通识"><!---->通识<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/HTML.html" aria-label="HTML"><!---->HTML<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/HTTP/%E8%B5%84%E6%BA%90%E5%92%8CURI.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/VUE/Vue3/%E7%AE%80%E4%BB%8B.html" aria-label="Vue"><!---->Vue<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/CSS.html" aria-label="CSS"><!---->CSS<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/Nodejs.html" aria-label="Nodejs"><!---->Nodejs<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%89%8D%E7%AB%AF/Nginx.html" aria-label="Nginx"><!---->Nginx<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="GIt"><span class="title"><!---->GIt</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Git/" aria-label="Git"><!---->Git<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Git/Github.html" aria-label="Github"><!---->Github<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/Git/Gitlab.html" aria-label="Gitlab"><!---->Gitlab<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="娱乐"><span class="title"><!---->娱乐</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%A8%B1%E4%B9%90/Bot/" aria-label="Bot"><!---->Bot<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%A8%B1%E4%B9%90/sovits/sovits_32k.html" aria-label="sovits"><!---->sovits<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="学习路线"><span class="title"><!---->学习路线</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/dailynotes/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.html" aria-label="机器学习"><!---->机器学习<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/233Official/dailynotes" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/" aria-label="Go"><!---->Go<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><!----><span class="vp-sidebar-title">Go语言圣经学习随笔</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH1-%E5%85%A5%E9%97%A8.html" aria-label="CH1.入门"><!---->CH1.入门<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH2-%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84.html" aria-label="CH2.程序结构"><!---->CH2.程序结构<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH3-%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" aria-label="CH3.基础数据类型"><!---->CH3.基础数据类型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH4-%E5%A4%8D%E5%90%88%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" aria-label="CH4.复合数据类型"><!---->CH4.复合数据类型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH5-%E5%87%BD%E6%95%B0.html" aria-label=" CH5.函数"><!----> CH5.函数<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH6-%E6%96%B9%E6%B3%95.html" aria-label="CH6.方法"><!---->CH6.方法<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH7-%E6%8E%A5%E5%8F%A3.html" aria-label="CH7.接口"><!---->CH7.接口<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH8-Goroutines%E5%92%8CChannels.html" aria-label="CH8.Goroutines和Channels"><!---->CH8.Goroutines和Channels<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH9-%E5%9F%BA%E4%BA%8E%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F%E7%9A%84%E5%B9%B6%E5%8F%91.html" aria-label="CH9.基于共享变量的并发"><!---->CH9.基于共享变量的并发<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH10-%E5%8C%85%E5%92%8C%E5%B7%A5%E5%85%B7.html" aria-label="CH10.包和工具"><!---->CH10.包和工具<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH11-%E6%B5%8B%E8%AF%95.html" aria-label="CH11.测试"><!---->CH11.测试<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH12-%E5%8F%8D%E5%B0%84.html" aria-label="CH12.反射"><!---->CH12.反射<!----></a></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->CH11.测试</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-07-09T17:13:27.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 32 分钟</span><meta property="timeRequired" content="PT32M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/dailynotes/#ch11-1-go-test">CH11.1.go test</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/dailynotes/#ch11-2-测试函数">CH11.2.测试函数</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ex11-1-为4-3节中的charcount程序编写测试。">EX11.1.为4.3节中的charcount程序编写测试。</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ch11-2-1-随机测试">CH11.2.1.随机测试</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ch11-2-2-测试一个命令">CH11.2.2.测试一个命令</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ch11-2-3-白盒测试">CH11.2.3.白盒测试</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ch11-2-4-外部测试包">CH11.2.4.外部测试包</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ch11-2-5-编写有效的测试">CH11.2.5.编写有效的测试</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ch11-2-6-避免脆弱的测试">CH11.2.6.避免脆弱的测试</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/dailynotes/#ch11-3-测试覆盖率">CH11.3.测试覆盖率</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/dailynotes/#ch11-4-基准测试">CH11.4.基准测试</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/dailynotes/#ex11-6-为popcount函数编写基准测试">EX11.6.为PopCount函数编写基准测试</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/dailynotes/#ch11-5-剖析">CH11.5.剖析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/dailynotes/#ch11-6-示例函数">CH11.6.示例函数</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="ch11-测试" tabindex="-1"><a class="header-anchor" href="#ch11-测试"><span>CH11.测试</span></a></h1><hr><ul><li><a href="#ch11%E6%B5%8B%E8%AF%95">CH11.测试</a><ul><li><a href="#ch111go-test">CH11.1.go test</a></li><li><a href="#ch112%E6%B5%8B%E8%AF%95%E5%87%BD%E6%95%B0">CH11.2.测试函数</a><ul><li><a href="#ex111%E4%B8%BA43%E8%8A%82%E4%B8%AD%E7%9A%84charcount%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95">EX11.1.为4.3节中的charcount程序编写测试。</a></li><li><a href="#ch1121%E9%9A%8F%E6%9C%BA%E6%B5%8B%E8%AF%95">CH11.2.1.随机测试</a><ul><li><a href="#ex114%E4%BF%AE%E6%94%B9randompalindrome%E5%87%BD%E6%95%B0">EX11.4.修改randomPalindrome函数</a></li></ul></li><li><a href="#ch1122%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%AA%E5%91%BD%E4%BB%A4">CH11.2.2.测试一个命令</a></li><li><a href="#ch1123%E7%99%BD%E7%9B%92%E6%B5%8B%E8%AF%95">CH11.2.3.白盒测试</a></li><li><a href="#ch1124%E5%A4%96%E9%83%A8%E6%B5%8B%E8%AF%95%E5%8C%85">CH11.2.4.外部测试包</a></li><li><a href="#ch1125%E7%BC%96%E5%86%99%E6%9C%89%E6%95%88%E7%9A%84%E6%B5%8B%E8%AF%95">CH11.2.5.编写有效的测试</a><ul><li><a href="#ex115%E7%94%A8%E8%A1%A8%E6%A0%BC%E9%A9%B1%E5%8A%A8%E7%9A%84%E6%8A%80%E6%9C%AF%E6%89%A9%E5%B1%95testsplit%E6%B5%8B%E8%AF%95">EX11.5.用表格驱动的技术扩展TestSplit测试</a></li></ul></li><li><a href="#ch1126%E9%81%BF%E5%85%8D%E8%84%86%E5%BC%B1%E7%9A%84%E6%B5%8B%E8%AF%95">CH11.2.6.避免脆弱的测试</a></li></ul></li><li><a href="#ch113%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87">CH11.3.测试覆盖率</a></li><li><a href="#ch114%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95">CH11.4.基准测试</a><ul><li><a href="#ex116%E4%B8%BApopcount%E5%87%BD%E6%95%B0%E7%BC%96%E5%86%99%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95">EX11.6.为PopCount函数编写基准测试</a></li></ul></li><li><a href="#ch115%E5%89%96%E6%9E%90">CH11.5.剖析</a></li><li><a href="#ch116%E7%A4%BA%E4%BE%8B%E5%87%BD%E6%95%B0">CH11.6.示例函数</a></li></ul></li></ul><hr><blockquote><p>PS: 这章内容读起来也比较丝滑,挺不错的</p></blockquote><blockquote><p><a href="https://golang-china.github.io/gopl-zh/ch11/ch11.html" target="_blank" rel="noopener noreferrer">测试 - Go语言圣经 (golang-china.github.io)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>我们说测试的时候一般是指自动化测试，也就是写一些小的程序用来检测被测试代码（产品代码）的行为和预期的一样，这些通常都是精心设计的执行某些特定的功能或者是通过随机性的输入待验证边界的处理。</p><p>Go语言的测试技术是相对低级的。它依赖一个go test测试命令和一组按照约定方式编写的测试函数，测试命令可以运行这些测试函数。编写相对轻量级的纯测试代码是有效的</p><p>在实践中，编写测试代码和编写程序本身并没有多大区别。我们编写的每一个函数也是针对每个具体的任务。</p><hr><h2 id="ch11-1-go-test" tabindex="-1"><a class="header-anchor" href="#ch11-1-go-test"><span>CH11.1.go test</span></a></h2><blockquote><p><a href="https://golang-china.github.io/gopl-zh/ch11/ch11-01.html" target="_blank" rel="noopener noreferrer">go test - Go语言圣经 (golang-china.github.io)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>go test命令是一个按照一定的约定和组织来测试代码的程序。在包目录内，所有以<code>_test.go</code>为后缀名的源文件在执行go build时不会被构建成包的一部分，它们是go test测试的一部分。</p><p>在<code>*_test.go</code>文件中，有三种类型的函数：测试函数、基准测试（benchmark）(性能测试)函数、示例函数。</p><ul><li><p>一个测试函数是以Test为函数名前缀的函数，用于测试程序的一些逻辑行为是否正确；go test命令会调用这些测试函数并报告测试结果是PASS或FAIL。</p></li><li><p>基准测试函数是以 <code>Benchmark</code> 为函数名前缀的函数，它们用于衡量一些函数的性能；go test命令会多次运行基准测试函数以计算一个平均的执行时间。</p></li><li><p>示例函数是以Example为函数名前缀的函数，提供一个由编译器保证正确性的示例文档。</p></li></ul><p>我们将在11.2节讨论测试函数的所有细节，并在11.4节讨论基准测试函数的细节，然后在11.6节讨论示例函数的细节。</p><p>go test命令会遍历所有的<code>*_test.go</code>文件中符合上述命名规则的函数，生成一个临时的main包用于调用相应的测试函数，接着构建并运行、报告测试结果，最后清理测试中生成的临时文件。</p><hr><h2 id="ch11-2-测试函数" tabindex="-1"><a class="header-anchor" href="#ch11-2-测试函数"><span>CH11.2.测试函数</span></a></h2><blockquote><p><a href="https://golang-china.github.io/gopl-zh/ch11/ch11-02.html" target="_blank" rel="noopener noreferrer">测试函数 - Go语言圣经 (golang-china.github.io)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>每个测试函数必须导入testing包。测试函数有如下的签名：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestName</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试函数的名字必须以Test开头，可选的后缀名必须以大写字母开头：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestSin</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">TestCos</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">TestLog</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 <code>t</code> 参数用于报告测试失败和附加的日志信息。</p><p>让我们定义一个实例包 <code>gopl.io/ch11/word1</code>，其中只有一个函数IsPalindrome用于检查一个字符串是否从前向后和从后向前读都是一样的。（下面这个实现对于一个字符串是否是回文字符串前后重复测试了两次；我们稍后会再讨论这个问题。）</p><p><code>ch11/word1</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Package word provides utilities for word games.</span>
<span class="token keyword">package</span> word

<span class="token comment">// IsPalindrome reports whether s reads the same forward and backward.</span>
<span class="token comment">// (Our first attempt.)</span>
<span class="token keyword">func</span> <span class="token function">IsPalindrome</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> s <span class="token punctuation">{</span>
        <span class="token keyword">if</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> s<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在相同的目录下，<code>word_test.go</code> 测试文件中包含了 <code>TestPalindrome</code> 和 <code>TestNonPalindrome</code> 两个测试函数。每一个都是测试 <code>IsPalindrome</code> 是否给出正确的结果，并使用 <code>t.Error</code> 报告失败信息：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> word

<span class="token keyword">import</span> <span class="token string">&quot;testing&quot;</span>

<span class="token keyword">func</span> <span class="token function">TestPalindrome</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">IsPalindrome</span><span class="token punctuation">(</span><span class="token string">&quot;detartrated&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">`IsPalindrome(&quot;detartrated&quot;) = false`</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">IsPalindrome</span><span class="token punctuation">(</span><span class="token string">&quot;kayak&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">`IsPalindrome(&quot;kayak&quot;) = false`</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestNonPalindrome</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token function">IsPalindrome</span><span class="token punctuation">(</span><span class="token string">&quot;palindrome&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">`IsPalindrome(&quot;palindrome&quot;) = true`</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>go test</code>命令如果没有参数指定包那么将默认采用当前目录对应的包（和<code>go build</code>命令一样）。我们可以用下面的命令构建和运行测试。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709143615192.png" alt="image-20240709143615192"></p><p>结果还比较满意，我们运行了这个程序， 不过没有提前退出是因为还没有遇到BUG报告。不过一个法国名为“Noelle Eve Elleon”的用户会抱怨IsPalindrome函数不能识别“été”。另外一个来自美国中部用户的抱怨则是不能识别“A man, a plan, a canal: Panama.”。执行特殊和小的BUG报告为我们提供了新的更自然的测试用例。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestFrenchPalindrome</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">IsPalindrome</span><span class="token punctuation">(</span><span class="token string">&quot;été&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">`IsPalindrome(&quot;été&quot;) = false`</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestCanalPalindrome</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    input <span class="token operator">:=</span> <span class="token string">&quot;A man, a plan, a canal: Panama&quot;</span>
    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">IsPalindrome</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">`IsPalindrome(%q) = false`</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709143934552.png" alt="image-20240709143934552"></p><p>先编写测试用例并观察到测试用例触发了和用户报告的错误相同的描述是一个好的测试习惯。只有这样，我们才能定位我们要真正解决的问题。</p><hr><p>先写测试用例的另外的好处是，运行测试通常会比手工描述报告的处理更快，这让我们可以进行快速地迭代。如果测试集有很多运行缓慢的测试，我们可以通过只选择运行某些特定的测试来加快测试速度。</p><p>参数<code>-v</code>可用于打印每个测试函数的名字和运行时间：</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709144352425.png" alt="image-20240709144352425"></p><hr><p>参数<code>-run</code>对应一个正则表达式，只有测试函数名被它正确匹配的测试函数才会被<code>go test</code>测试命令运行：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go <span class="token builtin class-name">test</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-run</span><span class="token operator">=</span><span class="token string">&quot;French|Canal&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709144553407.png" alt="image-20240709144553407"></p><hr><p>当然，一旦我们已经修复了失败的测试用例，在我们提交代码更新之前，我们应该以不带参数的<code>go test</code>命令运行全部的测试用例，以确保修复失败测试的同时没有引入新的问题。</p><hr><p>我们现在的任务就是修复这些错误。简要分析后发现第一个BUG的原因是我们采用了 byte而不是rune序列，所以像 <code>été</code> 中的 <code>é</code> 等非ASCII字符不能正确处理。第二个BUG是因为没有忽略空格和字母的大小写导致的。</p><blockquote><ul><li><p>byte</p><ul><li><p><strong>定义</strong>：<code>byte</code>是<code>uint8</code>的别名，表示8位无符号整数。</p></li><li><p><strong>范围</strong>：0到255。</p></li><li><p><strong>用途</strong>：通常用于处理原始的二进制数据，例如文件I/O、网络通信，以及表示UTF-8编码的字符串中的单个字节。</p></li></ul><p><code>byte</code>类型的字符串通常用于处理ASCII字符，因为每个字符都可以用一个字节表示。对于UTF-8编码的字符串，每个字符可能由一个或多个字节组成。</p></li><li><p>rune</p><ul><li><p><strong>定义</strong>：<code>rune</code>是<code>int32</code>的别名，表示32位有符号整数。</p></li><li><p><strong>范围</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup></mrow><annotation encoding="application/x-tex">−2^{31}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span></span></span></span>到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mn>31</mn><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{31−1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>，但通常用于表示Unicode字符，即0到0x10FFFF。</p></li><li><p><strong>用途</strong>：用于处理Unicode字符，确保每个字符都可以用一个整数表示，即使字符在UTF-8编码中需要多个字节。</p></li></ul><p><code>rune</code>类型的字符串通常用于处理多字节字符集，确保每个字符都是一个独立的单元，无论其编码长度如何。</p></li></ul><p>在<code>byte</code>循环中，每个字符可能是一个字节，因此对于UTF-8多字节字符（例如中文字符），会显示为不正确的字符（�）。而在<code>rune</code>循环中，每个字符都是一个独立的Unicode字符，因此能够正确显示每个字符。</p></blockquote><p>针对上述两个BUG，我们仔细重写了函数：</p><p><code>ch11/word2</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Package word provides utilities for word games.</span>
<span class="token keyword">package</span> word

<span class="token keyword">import</span> <span class="token string">&quot;unicode&quot;</span>

<span class="token comment">// IsPalindrome reports whether s reads the same forward and backward.</span>
<span class="token comment">// Letter case is ignored, as are non-letters.</span>
<span class="token keyword">func</span> <span class="token function">IsPalindrome</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> letters <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> s <span class="token punctuation">{</span>
        <span class="token keyword">if</span> unicode<span class="token punctuation">.</span><span class="token function">IsLetter</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            letters <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>letters<span class="token punctuation">,</span> unicode<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> letters <span class="token punctuation">{</span>
        <span class="token keyword">if</span> letters<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> letters<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>letters<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同时我们也将之前的所有测试数据合并到了一个测试中的表格中。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestIsPalindrome</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        input <span class="token builtin">string</span>
        want  <span class="token builtin">bool</span>
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;ab&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;kayak&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;detartrated&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;A man, a plan, a canal: Panama&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;Evil I did dwell; lewd did I live.&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;Able was I ere I saw Elba&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;été&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;Et se resservir, ivresse reste.&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;palindrome&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// non-palindrome</span>
        <span class="token punctuation">{</span><span class="token string">&quot;desserts&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment">// semi-palindrome</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> test <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">IsPalindrome</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> test<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;IsPalindrome(%q) = %v&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>input<span class="token punctuation">,</span> got<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709150046770.png" alt="image-20240709150046770"></p><hr><p>这种表格驱动的测试在Go语言中很常见。我们可以很容易地向表格添加新的测试数据，并且后面的测试逻辑也没有冗余，这样我们可以有更多的精力去完善错误信息。</p><p>失败测试的输出并不包括调用 <code>t.Errorf</code> 时刻的堆栈调用信息。和其他编程语言或测试框架的assert断言不同，<code>t.Errorf</code> 调用也没有引起panic异常或停止测试的执行。即使表格中前面的数据导致了测试的失败，表格后面的测试数据依然会运行测试，因此在一个测试中我们可能了解多个失败的信息。</p><p>如果我们真的需要停止测试，或许是因为初始化失败或可能是早先的错误导致了后续错误等原因，我们可以使用 <code>t.Fatal</code> 或 <code>t.Fatalf</code> 停止当前测试函数。它们必须在和测试函数同一个goroutine内调用。</p><p>测试失败的信息一般的形式是 <code>f(x) = y, want z</code>，其中f(x)解释了失败的操作和对应的输入，y是实际的运行结果，z是期望的正确的结果。就像前面检查回文字符串的例子，实际的函数用于f(x)部分。</p><p>显示x是表格驱动型测试中比较重要的部分，因为同一个断言可能对应不同的表格项执行多次。要避免无用和冗余的信息。在测试类似 <code>IsPalindrome</code> 返回布尔类型的函数时，可以忽略并没有额外信息的z部分。如果x、y或z是y的长度，输出一个相关部分的简明总结即可。测试的作者应该要努力帮助程序员诊断测试失败的原因。</p><hr><h3 id="ex11-1-为4-3节中的charcount程序编写测试。" tabindex="-1"><a class="header-anchor" href="#ex11-1-为4-3节中的charcount程序编写测试。"><span>EX11.1.为4.3节中的charcount程序编写测试。</span></a></h3><p><strong>练习 11.1:</strong> 为4.3节中的 <code>charcount</code> 程序编写测试。</p><p><code>charcount.go</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// charcount.go</span>
<span class="token keyword">package</span> charcount

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;bufio&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;os&quot;</span>
	<span class="token string">&quot;unicode&quot;</span>
	<span class="token string">&quot;unicode/utf8&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// CharCount computes counts of Unicode characters from the provided reader.</span>
<span class="token keyword">func</span> <span class="token function">CharCount</span><span class="token punctuation">(</span>r io<span class="token punctuation">.</span>Reader<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">rune</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>utf8<span class="token punctuation">.</span>UTFMax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	counts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">rune</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>    <span class="token comment">// counts of Unicode characters</span>
	<span class="token keyword">var</span> utflen <span class="token punctuation">[</span>utf8<span class="token punctuation">.</span>UTFMax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token comment">// count of lengths of UTF-8 encodings</span>
	invalid <span class="token operator">:=</span> <span class="token number">0</span>                    <span class="token comment">// count of invalid UTF-8 characters</span>

	in <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		r<span class="token punctuation">,</span> n<span class="token punctuation">,</span> err <span class="token operator">:=</span> in<span class="token punctuation">.</span><span class="token function">ReadRune</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns rune, nbytes, error</span>
		<span class="token keyword">if</span> err <span class="token operator">==</span> io<span class="token punctuation">.</span>EOF <span class="token punctuation">{</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> utflen<span class="token punctuation">,</span> invalid<span class="token punctuation">,</span> err
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> r <span class="token operator">==</span> unicode<span class="token punctuation">.</span>ReplacementChar <span class="token operator">&amp;&amp;</span> n <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			invalid<span class="token operator">++</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		counts<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">++</span>
		utflen<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">++</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> counts<span class="token punctuation">,</span> utflen<span class="token punctuation">,</span> invalid<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	counts<span class="token punctuation">,</span> utflen<span class="token punctuation">,</span> invalid<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CharCount</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;charcount: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;rune\tcount\n&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> c<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> counts <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%q\t%d\n&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;\nlen\tcount\n&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> utflen <span class="token punctuation">{</span>
		<span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> invalid <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n%d invalid UTF-8 characters\n&quot;</span><span class="token punctuation">,</span> invalid<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><code>charcount_test.go</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// charcount_test.go</span>
<span class="token keyword">package</span> charcount

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;strings&quot;</span>
	<span class="token string">&quot;testing&quot;</span>
	<span class="token string">&quot;unicode/utf8&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">TestCharCount</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	input <span class="token operator">:=</span> <span class="token string">&quot;Hello, 世界&quot;</span>
	expectedCounts <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">rune</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span>
		<span class="token char">&#39;H&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token char">&#39;e&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token char">&#39;l&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token char">&#39;o&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token char">&#39;,&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token char">&#39; &#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token char">&#39;世&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token char">&#39;界&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	expectedUtfLen <span class="token operator">:=</span> <span class="token punctuation">[</span>utf8<span class="token punctuation">.</span>UTFMax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span>

	r <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
	counts<span class="token punctuation">,</span> utflen<span class="token punctuation">,</span> invalid<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CharCount</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;CharCount failed: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> r<span class="token punctuation">,</span> count <span class="token operator">:=</span> <span class="token keyword">range</span> expectedCounts <span class="token punctuation">{</span>
		<span class="token keyword">if</span> counts<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">!=</span> count <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;For rune %q, expected %d but got %d&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> count<span class="token punctuation">,</span> counts<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 判断 x 字节字符数量</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> count <span class="token operator">:=</span> <span class="token keyword">range</span> expectedUtfLen <span class="token punctuation">{</span>
		<span class="token keyword">if</span> utflen<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> count <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;For UTF length %d, expected %d but got %d&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> count<span class="token punctuation">,</span> utflen<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> invalid <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Expected 0 invalid characters but got %d&quot;</span><span class="token punctuation">,</span> invalid<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709160014708.png" alt="image-20240709160014708"></p><hr><h3 id="ch11-2-1-随机测试" tabindex="-1"><a class="header-anchor" href="#ch11-2-1-随机测试"><span>CH11.2.1.随机测试</span></a></h3><p>表格驱动的测试便于构造基于精心挑选的测试数据的测试用例。另一种测试思路是随机测试，也就是通过构造更广泛的随机输入来测试探索函数的行为。</p><p>那么对于一个随机的输入，我们如何能知道希望的输出结果呢？这里有两种处理策略。第一个是编写另一个对照函数，使用简单和清晰的算法，虽然效率较低但是行为和要测试的函数是一致的，然后针对相同的随机输入检查两者的输出结果。第二种是生成的随机输入的数据遵循特定的模式，这样我们就可以知道期望的输出的模式。</p><p>下面的例子使用的是第二种方法：randomPalindrome函数用于随机生成回文字符串。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;math/rand&quot;</span>

<span class="token comment">// randomPalindrome returns a palindrome whose length and contents</span>
<span class="token comment">// are derived from the pseudo-random number generator rng.</span>
<span class="token keyword">func</span> <span class="token function">randomPalindrome</span><span class="token punctuation">(</span>rng <span class="token operator">*</span>rand<span class="token punctuation">.</span>Rand<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    n <span class="token operator">:=</span> rng<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token comment">// random length up to 24</span>
    runes <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        r <span class="token operator">:=</span> <span class="token function">rune</span><span class="token punctuation">(</span>rng<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">0x1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// random rune up to &#39;\u0999&#39;</span>
        runes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> r
        runes<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> r
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>runes<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestRandomPalindromes</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Initialize a pseudo-random number generator.</span>
    seed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">Logf</span><span class="token punctuation">(</span><span class="token string">&quot;Random seed: %d&quot;</span><span class="token punctuation">,</span> seed<span class="token punctuation">)</span>
    rng <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        p <span class="token operator">:=</span> <span class="token function">randomPalindrome</span><span class="token punctuation">(</span>rng<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">IsPalindrome</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;IsPalindrome(%q) = false&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709160341692.png" alt="image-20240709160341692"></p><p>虽然随机测试会有不确定因素，但是它也是至关重要的，我们可以从失败测试的日志获取足够的信息。在我们的例子中，输入 <code>IsPalindrome</code> 的p参数将告诉我们真实的数据，但是对于函数将接受更复杂的输入，不需要保存所有的输入，只要日志中简单地记录随机数种子即可（像上面的方式）。有了这些随机数初始化种子，我们可以很容易修改测试代码以重现失败的随机测试。</p><p>通过使用当前时间作为随机种子，在整个过程中的每次运行测试命令时都将探索新的随机数据。如果你使用的是定期运行的自动化测试集成系统，随机测试将特别有价值。</p><hr><h4 id="ex11-4-修改randompalindrome函数" tabindex="-1"><a class="header-anchor" href="#ex11-4-修改randompalindrome函数"><span>EX11.4.修改randomPalindrome函数</span></a></h4><p><strong>练习 11.4:</strong> 修改 <code>randomPalindrome</code> 函数，以探索 <code>IsPalindrome</code> 是否对标点和空格做了正确处理。</p><p>可以定义了一个字符集 <code>charset</code>，包含字母、空格和标点符号;</p><p>在生成回文时从字符集中随机选择字符，包括字母、空格和标点符号，并保证生成的字符串是回文。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> word

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;math/rand&quot;</span>
	<span class="token string">&quot;testing&quot;</span>
	<span class="token string">&quot;time&quot;</span>
	<span class="token string">&quot;unicode&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// IsPalindrome reports whether s reads the same forward and backward.</span>
<span class="token comment">// Letter case is ignored, as are non-letters.</span>
<span class="token keyword">func</span> <span class="token function">IsPalindrome</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> letters <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> s <span class="token punctuation">{</span>
		<span class="token keyword">if</span> unicode<span class="token punctuation">.</span><span class="token function">IsLetter</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			letters <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>letters<span class="token punctuation">,</span> unicode<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> letters <span class="token punctuation">{</span>
		<span class="token keyword">if</span> letters<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> letters<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>letters<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// randomPalindrome returns a palindrome whose length and contents</span>
<span class="token comment">// are derived from the pseudo-random number generator rng.</span>
<span class="token keyword">func</span> <span class="token function">randomPalindrome</span><span class="token punctuation">(</span>rng <span class="token operator">*</span>rand<span class="token punctuation">.</span>Rand<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	n <span class="token operator">:=</span> rng<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token comment">// random length up to 24</span>
	runes <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">rune</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	charset <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">rune</span><span class="token punctuation">(</span><span class="token string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ,.!?&quot;</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		r <span class="token operator">:=</span> charset<span class="token punctuation">[</span>rng<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
		runes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> r
		runes<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> r 
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>runes<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestRandomPalindromes</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Initialize a pseudo-random number generator.</span>
	seed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	t<span class="token punctuation">.</span><span class="token function">Logf</span><span class="token punctuation">(</span><span class="token string">&quot;Random seed: %d&quot;</span><span class="token punctuation">,</span> seed<span class="token punctuation">)</span>
	rng <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">NewSource</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		p <span class="token operator">:=</span> <span class="token function">randomPalindrome</span><span class="token punctuation">(</span>rng<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">IsPalindrome</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;IsPalindrome(%q) = false&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/image-20240709161139347.png" alt="image-20240709161139347"></p><hr><h3 id="ch11-2-2-测试一个命令" tabindex="-1"><a class="header-anchor" href="#ch11-2-2-测试一个命令"><span>CH11.2.2.测试一个命令</span></a></h3><p>对于测试包<code>go test</code>是一个有用的工具，但是稍加努力我们也可以用它来测试可执行程序。如果一个包的名字是 main，那么在构建时会生成一个可执行程序，不过main包可以作为一个包被测试器代码导入。</p><p>让我们为2.3.2节的echo程序编写一个测试。我们先将程序拆分为两个函数：echo函数完成真正的工作，main函数用于处理命令行输入参数和echo可能返回的错误。</p><p><code>ch11/echo</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// Echo prints its command-line arguments.</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;flag&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;io&quot;</span>
    <span class="token string">&quot;os&quot;</span>
    <span class="token string">&quot;strings&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
    n <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">Bool</span><span class="token punctuation">(</span><span class="token string">&quot;n&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;omit trailing newline&quot;</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;separator&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> out io<span class="token punctuation">.</span>Writer <span class="token operator">=</span> os<span class="token punctuation">.</span>Stdout <span class="token comment">// modified during testing</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> flag<span class="token punctuation">.</span><span class="token function">Args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;echo: %v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">echo</span><span class="token punctuation">(</span>newline <span class="token builtin">bool</span><span class="token punctuation">,</span> sep <span class="token builtin">string</span><span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprint</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> newline <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在测试中我们可以用各种参数和标志调用echo函数，然后检测它的输出是否正确</p><p>我们通过增加参数来减少echo函数对全局变量的依赖。</p><p>我们还增加了一个全局名为out的变量来替代直接使用os.Stdout，这样测试代码可以根据需要将out修改为不同的对象以便于检查。</p><p>下面就是 <code>echo_test.go</code> 文件中的测试代码：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;bytes&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;testing&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">TestEcho</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        newline <span class="token builtin">bool</span>
        sep     <span class="token builtin">string</span>
        args    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
        want    <span class="token builtin">string</span>
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;\t&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;one\ttwo\tthree\n&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;a,b,c\n&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;1:2:3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> test <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        descr <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;echo(%v, %q, %q)&quot;</span><span class="token punctuation">,</span>
            test<span class="token punctuation">.</span>newline<span class="token punctuation">,</span> test<span class="token punctuation">.</span>sep<span class="token punctuation">,</span> test<span class="token punctuation">.</span>args<span class="token punctuation">)</span>

        out <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span> <span class="token comment">// captured output</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">echo</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>newline<span class="token punctuation">,</span> test<span class="token punctuation">.</span>sep<span class="token punctuation">,</span> test<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%s failed: %v&quot;</span><span class="token punctuation">,</span> descr<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        got <span class="token operator">:=</span> out<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> got <span class="token operator">!=</span> test<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%s = %q, want %q&quot;</span><span class="token punctuation">,</span> descr<span class="token punctuation">,</span> got<span class="token punctuation">,</span> test<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161130143.png" alt="image-20240716112957811"></p><hr><p>要注意的是测试代码和产品代码在同一个包。虽然是main包，也有对应的main入口函数，但是在测试的时候main包只是TestEcho测试函数导入的一个普通包，里面main函数并没有被导出，而是被忽略的。</p><p>通过将测试放到表格中，我们很容易添加新的测试用例。让我通过增加下面的测试用例来看看失败的情况是怎么样的：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;a b c\n&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// NOTE: wrong expectation!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161136465.png" alt="image-20240716113608264"></p><p>错误信息描述了尝试的操作（使用Go类似语法），实际的结果和期望的结果。通过这样的错误信息，你可以在检视代码之前就很容易定位错误的原因。</p><p>要注意的是在测试代码中并没有调用 <code>log.Fatal</code> 或 <code>os.Exit</code>，因为调用这类函数会导致程序提前退出；</p><p>调用这些函数的特权应该放在main函数中。如果真的有意外的事情导致函数发生panic异常，测试驱动应该尝试用recover捕获异常，然后将当前测试当作失败处理。如果是可预期的错误，例如非法的用户输入、找不到文件或配置文件不当等应该通过返回一个非空的error的方式处理。幸运的是（上面的意外只是一个插曲），我们的echo示例是比较简单的也没有需要返回非空error的情况。</p><hr><h3 id="ch11-2-3-白盒测试" tabindex="-1"><a class="header-anchor" href="#ch11-2-3-白盒测试"><span>CH11.2.3.白盒测试</span></a></h3><p>一种测试分类的方法是基于测试者是否需要了解被测试对象的内部工作原理。</p><ul><li><p>黑盒测试只需要测试包公开的文档和API行为，内部实现对测试代码是透明的。</p></li><li><p>相反，白盒测试有访问包内部函数和数据结构的权限，因此可以做到一些普通客户端无法实现的测试。</p><p>例如，一个白盒测试可以在每个操作之后检测不变量的数据类型。（白盒测试只是一个传统的名称，其实称为clear box测试会更准确。）</p></li></ul><hr><p>黑盒和白盒这两种测试方法是互补的。</p><ul><li>黑盒测试一般更健壮，随着软件实现的完善测试代码很少需要更新。它们可以帮助测试者了解真实客户的需求，也可以帮助发现API设计的一些不足之处。</li><li>相反，白盒测试则可以对内部一些棘手的实现提供更多的测试覆盖。</li></ul><hr><p>我们已经看到两种测试的例子</p><ul><li><code>TestIsPalindrome</code> 测试仅仅使用导出的 <code>IsPalindrome</code> 函数，因此这是一个黑盒测试</li><li><code>TestEcho</code> 测试则调用了内部的echo函数，并且更新了内部的out包级变量，这两个都是未导出的，因此这是白盒测试</li></ul><hr><p>当我们准备 <code>TestEcho</code> 测试的时候，我们修改了echo函数使用包级的out变量作为输出对象，因此测试代码可以用另一个实现代替标准输出，这样可以方便对比echo输出的数据。</p><p>使用类似的技术，我们可以将产品代码的其他部分也替换为一个容易测试的伪对象。使用伪对象的好处是我们可以方便配置，容易预测，更可靠，也更容易观察。同时也可以避免一些不良的副作用，例如更新生产数据库或信用卡消费行为。</p><hr><p>下面的代码演示了为用户提供网络存储的web服务中的配额检测逻辑。当用户使用了超过90%的存储配额之后将发送提醒邮件。（译注：一般在实现业务机器监控，包括磁盘、cpu、网络等的时候，需要类似的到达阈值=&gt;触发报警的逻辑，所以是很实用的案例。）</p><p><code>ch11/storage1</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> storage

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;log&quot;</span>
    <span class="token string">&quot;net/smtp&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">bytesInUse</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>

<span class="token comment">// Email sender configuration.</span>
<span class="token comment">// NOTE: never put passwords in source code!</span>
<span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token string">&quot;notifications@example.com&quot;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token string">&quot;correcthorsebatterystaple&quot;</span>
<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">&quot;smtp.example.com&quot;</span>

<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token string">`Warning: you are using %d bytes of storage,
%d%% of your quota.`</span>

<span class="token keyword">func</span> <span class="token function">CheckQuota</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    used <span class="token operator">:=</span> <span class="token function">bytesInUse</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
    <span class="token keyword">const</span> quota <span class="token operator">=</span> <span class="token number">1000000000</span> <span class="token comment">// 1GB</span>
    percent <span class="token operator">:=</span> <span class="token number">100</span> <span class="token operator">*</span> used <span class="token operator">/</span> quota
    <span class="token keyword">if</span> percent <span class="token operator">&lt;</span> <span class="token number">90</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token comment">// OK</span>
    <span class="token punctuation">}</span>
    msg <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> used<span class="token punctuation">,</span> percent<span class="token punctuation">)</span>
    auth <span class="token operator">:=</span> smtp<span class="token punctuation">.</span><span class="token function">PlainAuth</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> sender<span class="token punctuation">,</span> password<span class="token punctuation">,</span> hostname<span class="token punctuation">)</span>
    err <span class="token operator">:=</span> smtp<span class="token punctuation">.</span><span class="token function">SendMail</span><span class="token punctuation">(</span>hostname<span class="token operator">+</span><span class="token string">&quot;:587&quot;</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> sender<span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;smtp.SendMail(%s) failed: %s&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们想测试这段代码，但是我们并不希望发送真实的邮件。因此我们将邮件处理逻辑放到一个私有的notifyUser函数中。</p><p><code>ch11/storage2</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> storage

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;net/smtp&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">bytesInUse</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>

<span class="token comment">// Email sender configuration.</span>
<span class="token comment">// NOTE: never put passwords in source code!</span>
<span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token string">&quot;notifications@example.com&quot;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token string">&quot;correcthorsebatterystaple&quot;</span>
<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">&quot;smtp.example.com&quot;</span>

<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token string">`Warning: you are using %d bytes of storage,
%d%% of your quota.`</span>

<span class="token keyword">var</span> notifyUser <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	auth <span class="token operator">:=</span> smtp<span class="token punctuation">.</span><span class="token function">PlainAuth</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> sender<span class="token punctuation">,</span> password<span class="token punctuation">,</span> hostname<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> smtp<span class="token punctuation">.</span><span class="token function">SendMail</span><span class="token punctuation">(</span>hostname<span class="token operator">+</span><span class="token string">&quot;:587&quot;</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> sender<span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;smtp.SendEmail(%s) failed: %s&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CheckQuota</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	used <span class="token operator">:=</span> <span class="token function">bytesInUse</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
	<span class="token keyword">const</span> quota <span class="token operator">=</span> <span class="token number">1000000000</span> <span class="token comment">// 1GB</span>
	percent <span class="token operator">:=</span> <span class="token number">100</span> <span class="token operator">*</span> used <span class="token operator">/</span> quota
	<span class="token keyword">if</span> percent <span class="token operator">&lt;</span> <span class="token number">90</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token comment">// OK</span>
	<span class="token punctuation">}</span>
	msg <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> used<span class="token punctuation">,</span> percent<span class="token punctuation">)</span>
	<span class="token function">notifyUser</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在我们可以在测试中用伪邮件发送函数替代真实的邮件发送函数。它只是简单记录要通知的用户和邮件的内容。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> storage

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;strings&quot;</span>
    <span class="token string">&quot;testing&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">TestCheckQuotaNotifiesUser</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> notifiedUser<span class="token punctuation">,</span> notifiedMsg <span class="token builtin">string</span>
    notifyUser <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        notifiedUser<span class="token punctuation">,</span> notifiedMsg <span class="token operator">=</span> user<span class="token punctuation">,</span> msg
    <span class="token punctuation">}</span>

    <span class="token comment">// ...simulate a 980MB-used condition...</span>

    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token string">&quot;joe@example.org&quot;</span>
    <span class="token function">CheckQuota</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token keyword">if</span> notifiedUser <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">&amp;&amp;</span> notifiedMsg <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;notifyUser not called&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> notifiedUser <span class="token operator">!=</span> user <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;wrong user (%s) notified, want %s&quot;</span><span class="token punctuation">,</span>
            notifiedUser<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> wantSubstring <span class="token operator">=</span> <span class="token string">&quot;98% of your quota&quot;</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>notifiedMsg<span class="token punctuation">,</span> wantSubstring<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;unexpected notification message &lt;&lt;%s&gt;&gt;, &quot;</span><span class="token operator">+</span>
            <span class="token string">&quot;want substring %q&quot;</span><span class="token punctuation">,</span> notifiedMsg<span class="token punctuation">,</span> wantSubstring<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里有一个问题：当测试函数返回后，CheckQuota将不能正常工作，因为notifyUsers依然使用的是测试函数的伪发送邮件函数（当更新全局对象的时候总会有这种风险）。</p><p>我们必须修改测试代码恢复 <code>notifyUsers</code> 原先的状态以便后续其他的测试没有影响，要确保所有的执行路径后都能恢复，包括测试失败或panic异常的情形。在这种情况下，我们建议使用defer语句来延后执行处理恢复的代码。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestCheckQuotaNotifiesUser</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Save and restore original notifyUser.</span>
    saved <span class="token operator">:=</span> notifyUser
    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> notifyUser <span class="token operator">=</span> saved <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Install the test&#39;s fake notifyUser.</span>
    <span class="token keyword">var</span> notifiedUser<span class="token punctuation">,</span> notifiedMsg <span class="token builtin">string</span>
    notifyUser <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        notifiedUser<span class="token punctuation">,</span> notifiedMsg <span class="token operator">=</span> user<span class="token punctuation">,</span> msg
    <span class="token punctuation">}</span>
    <span class="token comment">// ...rest of test...</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种处理模式可以用来暂时保存和恢复所有的全局变量，包括命令行标志参数、调试选项和优化参数；安装和移除导致生产代码产生一些调试信息的钩子函数；还有有些诱导生产代码进入某些重要状态的改变，比如超时、错误，甚至是一些刻意制造的并发行为等因素。</p><p>以这种方式使用全局变量是安全的，因为go test命令并不会同时并发地执行多个测试。</p><hr><h3 id="ch11-2-4-外部测试包" tabindex="-1"><a class="header-anchor" href="#ch11-2-4-外部测试包"><span>CH11.2.4.外部测试包</span></a></h3><p>考虑下这两个包：</p><ul><li><code>net/url</code> 包，提供了URL解析的功能</li><li><code>net/http</code> 包，提供了web服务和HTTP客户端的功能</li></ul><p>如我们所料，上层的 <code>net/http</code> 包依赖下层的 <code>net/url</code> 包。然后，<code>net/url</code> 包中的一个测试是演示不同 URL 和 HTTP 客户端的交互行为。也就是说，一个下层包的测试代码导入了上层的包。</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161452989.png" alt="img"></p><p>这样的行为在 <code>net/url</code> 包的测试代码中会导致包的循环依赖，正如图11.1中向上箭头所示，同时正如我们在10.1节所讲的，Go语言规范是禁止包的循环依赖的。</p><p>不过我们可以通过外部测试包的方式解决循环依赖的问题，也就是在 <code>net/url</code> 包所在的目录声明一个独立的 <code>url_test</code> 测试包。其中包名的 <code>_test</code> 后缀告诉go test工具它应该建立一个额外的包来运行测试。我们将这个外部测试包的导入路径视作是 <code>net/url_test</code> 会更容易理解，但实际上它并不能被其他任何包导入。</p><p>因为外部测试包是一个独立的包，所以能够导入那些<code>依赖待测代码本身</code>的其他辅助包；包内的测试代码就无法做到这点。在设计层面，外部测试包是在所有它依赖的包的上层，正如图11.2所示。</p><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161454651.png" alt="img"></p><p>通过避免循环的导入依赖，外部测试包可以更灵活地编写测试，特别是集成测试（需要测试多个组件之间的交互），可以像普通应用程序那样自由地导入其他包。</p><p>我们可以用go list命令查看包对应目录中哪些Go源文件是产品代码，哪些是包内测试，还有哪些是外部测试包。我们以fmt包作为一个例子：GoFiles表示产品代码对应的Go源文件列表；也就是go build命令要编译的部分。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ go list <span class="token parameter variable">-f</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.GoFiles<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token function">fmt</span>
<span class="token punctuation">[</span>doc.go format.go print.go scan.go<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161457468.png" alt="image-20240716145743213"></p><hr><p>TestGoFiles表示的是fmt包内部测试代码，以_test.go为后缀文件名，不过只在测试时被构建：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ go list <span class="token parameter variable">-f</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.TestGoFiles<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token function">fmt</span>
<span class="token punctuation">[</span>export_test.go<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161505055.png" alt="image-20240716150505823"></p><p>包的测试代码通常都在这些文件中，不过fmt包并非如此；稍后我们再解释export_test.go文件的作用。</p><hr><p>XTestGoFiles 表示的是属于外部测试包的测试代码，也就是 <code>fmt_test</code> 包，因此它们必须先导入fmt包。同样，这些文件也只是在测试时被构建运行：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ go list <span class="token parameter variable">-f</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.XTestGoFiles<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token function">fmt</span>
<span class="token punctuation">[</span>fmt_test.go scan_test.go stringer_test.go<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161507882.png" alt="image-20240716150718652"></p><hr><p>有时候外部测试包也需要访问被测试包内部的代码，例如在一个为了避免循环导入而被独立到外部测试包的白盒测试。在这种情况下，我们可以通过一些技巧解决：我们在包内的一个 <code>_test.go</code> 文件中导出一个内部的实现给外部测试包。因为这些代码只有在测试时才需要，因此一般会放在 <code>export_test.go</code> 文件中。</p><p>例如，<code>fmt</code> 包的 <code>fmt.Scanf</code> 函数需要 <code>unicode.IsSpace</code> 函数提供的功能。但是为了避免太多的依赖，<code>fmt</code> 包并没有导入包含巨大表格数据的 <code>unicode</code> 包；相反 <code>fmt</code> 包有一个叫 <code>isSpace</code> 内部的简易实现。</p><p>为了确保 <code>fmt.isSpace</code> 和 <code>unicode.IsSpace</code> 函数的行为保持一致，<code>fmt</code> 包谨慎地包含了一个测试。一个在外部测试包内的白盒测试，是无法直接访问到 <code>isSpace</code> 内部函数的，因此 <code>fmt</code> 通过一个后门导出了 <code>isSpace</code> 函数。<code>export_test.go</code> 文件就是专门用于外部测试包的后门。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> fmt

<span class="token keyword">var</span> IsSpace <span class="token operator">=</span> isSpace
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个测试文件并没有定义测试代码；它只是通过 <code>fmt.IsSpace</code> 简单导出了内部的 <code>isSpace</code> 函数，提供给外部测试包使用。这个技巧可以广泛用于位于外部测试包的白盒测试。</p><hr><h3 id="ch11-2-5-编写有效的测试" tabindex="-1"><a class="header-anchor" href="#ch11-2-5-编写有效的测试"><span>CH11.2.5.编写有效的测试</span></a></h3><p>许多Go语言新人会惊异于Go语言极简的测试框架。很多其它语言的测试框架都提供了识别测试函数的机制（通常使用反射或元数据），通过设置一些“setup”和“teardown”的钩子函数来执行测试用例运行的初始化和之后的清理操作，同时测试工具箱还提供了很多类似assert断言、值比较函数、格式化输出错误信息和停止一个失败的测试等辅助函数（通常使用异常机制）。虽然这些机制可以使得测试非常简洁，但是测试输出的日志却会像火星文一般难以理解。此外，虽然测试最终也会输出PASS或FAIL的报告，但是它们提供的信息格式却非常不利于代码维护者快速定位问题，因为失败信息的具体含义非常隐晦，比如“assert: 0 == 1”或成页的海量跟踪日志。</p><p>Go语言的测试风格则形成鲜明对比。它期望测试者自己完成大部分的工作，定义函数避免重复，就像普通编程那样。编写测试并不是一个机械的填空过程；一个测试也有自己的接口，尽管它的维护者也是测试仅有的一个用户。一个好的测试不应该引发其他无关的错误信息，它只要清晰简洁地描述问题的症状即可，有时候可能还需要一些上下文信息。在理想情况下，维护者可以在不看代码的情况下就能根据错误信息定位错误产生的原因。一个好的测试不应该在遇到一点小错误时就立刻退出测试，它应该尝试报告更多的相关的错误信息，因为我们可能从多个失败测试的模式中发现错误产生的规律。</p><hr><p>下面的断言函数比较两个值，然后生成一个通用的错误信息，并停止程序。它很好用也确实有效，但是当测试失败的时候，打印的错误信息却几乎是没有价值的。它并没有为快速解决问题提供一个很好的入口。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;strings&quot;</span>
    <span class="token string">&quot;testing&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// A poor assertion function.</span>
<span class="token keyword">func</span> <span class="token function">assertEqual</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> x <span class="token operator">!=</span> y <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d != %d&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    words <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot;a:b:c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span>
    <span class="token function">assertEqual</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从这个意义上说，断言函数犯了过早抽象的错误：仅仅测试两个整数是否相同，而没能根据上下文提供更有意义的错误信息。我们可以根据具体的错误打印一个更有价值的错误信息，就像下面例子那样。只有在测试中出现重复模式时才采用抽象。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s<span class="token punctuation">,</span> sep <span class="token operator">:=</span> <span class="token string">&quot;a:b:c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span>
    words <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sep<span class="token punctuation">)</span>
    <span class="token keyword">if</span> got<span class="token punctuation">,</span> want <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> want <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Split(%q, %q) returned %d words, want %d&quot;</span><span class="token punctuation">,</span>
            s<span class="token punctuation">,</span> sep<span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在的测试不仅报告了调用的具体函数、它的输入和结果的意义；并且打印的真实返回的值和期望返回的值；并且即使断言失败依然会继续尝试运行更多的测试。一旦我们写了这样结构的测试，下一步自然不是用更多的if语句来扩展测试用例，我们可以用像 <code>IsPalindrome</code> 的表驱动测试那样来准备更多的s和sep测试用例。</p><p>前面的例子并不需要额外的辅助函数，如果有可以使测试代码更简单的方法我们也乐意接受。（我们将在13.3节看到一个类似 <code>reflect.DeepEqual</code> 辅助函数。）一个好的测试的关键是首先实现你期望的具体行为，然后才是考虑简化测试代码、避免重复。如果直接从抽象、通用的测试库着手，很难取得良好结果。</p><hr><h4 id="ex11-5-用表格驱动的技术扩展testsplit测试" tabindex="-1"><a class="header-anchor" href="#ex11-5-用表格驱动的技术扩展testsplit测试"><span>EX11.5.用表格驱动的技术扩展TestSplit测试</span></a></h4><p><strong>练习11.5:</strong> 用表格驱动的技术扩展TestSplit测试，并打印期望的输出结果</p><p>照着前面 echo 的表驱动样例来写即可</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> split

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;strings&quot;</span>
	<span class="token string">&quot;testing&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">TestSplit</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> tests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
		sep  <span class="token builtin">string</span>
		args <span class="token builtin">string</span>
		want <span class="token builtin">int</span>
	<span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token punctuation">{</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;one\ttwo\tthree\n&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a,b,c\n&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1:2:3&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a b c\n&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a:b:c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> test <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
		words <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>args<span class="token punctuation">,</span> test<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
		<span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">;</span> got <span class="token operator">!=</span> test<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
			t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Split(%q,%q) returned %d words, want %d&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>args<span class="token punctuation">,</span> test<span class="token punctuation">.</span>sep<span class="token punctuation">,</span> got<span class="token punctuation">,</span> test<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://cdn.ayusummer233.top/DailyNotes/202407161631316.png" alt="image-20240716163145917"></p><hr><h3 id="ch11-2-6-避免脆弱的测试" tabindex="-1"><a class="header-anchor" href="#ch11-2-6-避免脆弱的测试"><span>CH11.2.6.避免脆弱的测试</span></a></h3><p>如果一个应用程序对于新出现的但有效的输入经常失败说明程序容易出bug（不够稳健）；同样，如果一个测试仅仅对程序做了微小变化就失败则称为脆弱。就像一个不够稳健的程序会挫败它的用户一样，一个脆弱的测试同样会激怒它的维护者。最脆弱的测试代码会在程序没有任何变化的时候产生不同的结果，时好时坏，处理它们会耗费大量的时间但是并不会得到任何好处。</p><p>当一个测试函数会产生一个复杂的输出如一个很长的字符串、一个精心设计的数据结构或一个文件时，人们很容易想预先写下一系列固定的用于对比的标杆数据。但是随着项目的发展，有些输出可能会发生变化，尽管很可能是一个改进的实现导致的。而且不仅仅是输出部分，函数复杂的输入部分可能也跟着变化了，因此测试使用的输入也就不再有效了。</p><p>避免脆弱测试代码的方法是只检测你真正关心的属性。保持测试代码的简洁和内部结构的稳定。特别是对断言部分要有所选择。不要对字符串进行全字匹配，而是针对那些在项目的发展中是比较稳定不变的子串。很多时候值得花力气来编写一个从复杂输出中提取用于断言的必要信息的函数，虽然这可能会带来很多前期的工作，但是它可以帮助迅速及时修复因为项目演化而导致的不合逻辑的失败测试。</p><hr><h2 id="ch11-3-测试覆盖率" tabindex="-1"><a class="header-anchor" href="#ch11-3-测试覆盖率"><span>CH11.3.测试覆盖率</span></a></h2><p>就其性质而言，测试不可能是完整的。计算机科学家Edsger Dijkstra曾说过：“测试能证明缺陷存在，而无法证明没有缺陷。”再多的测试也不能证明一个程序没有BUG。在最好的情况下，测试可以增强我们的信心：代码在很多重要场景下是可以正常工作的。</p><p>对待测程序执行的测试的程度称为测试的覆盖率。测试覆盖率并不能量化——即使最简单的程序的动态也是难以精确测量的——但是有启发式方法来帮助我们编写有效的测试代码。</p><p>这些启发式方法中，语句的覆盖率是最简单和最广泛使用的。语句的覆盖率是指在测试中至少被运行一次的代码占总代码数的比例。在本节中，我们使用<code>go test</code>命令中集成的测试覆盖率工具，来度量下面代码的测试覆盖率，帮助我们识别测试和我们期望间的差距。</p><p>下面的代码是一个表格驱动的测试，用于测试第七章的表达式求值程序：</p><p><code>ch7/eval</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestCoverage</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
        input <span class="token builtin">string</span>
        env   Env
        want  <span class="token builtin">string</span> <span class="token comment">// expected error from Parse/Check or result from Eval</span>
    <span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token string">&quot;x % 2&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">&quot;unexpected &#39;%&#39;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;!true&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">&quot;unexpected &#39;!&#39;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;log(10)&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">`unknown function &quot;log&quot;`</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;sqrt(1, 2)&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token string">&quot;call to sqrt has 2 args, want 1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;sqrt(A / pi)&quot;</span><span class="token punctuation">,</span> Env<span class="token punctuation">{</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">:</span> <span class="token number">87616</span><span class="token punctuation">,</span> <span class="token string">&quot;pi&quot;</span><span class="token punctuation">:</span> math<span class="token punctuation">.</span>Pi<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;167&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;pow(x, 3) + pow(y, 3)&quot;</span><span class="token punctuation">,</span> Env<span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;1729&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;5 / 9 * (F - 32)&quot;</span><span class="token punctuation">,</span> Env<span class="token punctuation">{</span><span class="token string">&quot;F&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;-40&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> test <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
        expr<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">Parse</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>input<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            err <span class="token operator">=</span> expr<span class="token punctuation">.</span><span class="token function">Check</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>Var<span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> test<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
                t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: got %q, want %q&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span>input<span class="token punctuation">,</span> err<span class="token punctuation">,</span> test<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        got <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%.6g&quot;</span><span class="token punctuation">,</span> expr<span class="token punctuation">.</span><span class="token function">Eval</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> got <span class="token operator">!=</span> test<span class="token punctuation">.</span>want <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: %v =&gt; %s, want %s&quot;</span><span class="token punctuation">,</span>
                test<span class="token punctuation">.</span>input<span class="token punctuation">,</span> test<span class="token punctuation">.</span>env<span class="token punctuation">,</span> got<span class="token punctuation">,</span> test<span class="token punctuation">.</span>want<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先，我们要确保所有的测试都正常通过：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-run</span><span class="token operator">=</span>Coverage gopl.io/ch7/eval
<span class="token operator">==</span><span class="token operator">=</span> RUN TestCoverage
--- PASS: TestCoverage <span class="token punctuation">(</span><span class="token number">0</span>.00s<span class="token punctuation">)</span>
PASS
ok      gopl.io/ch7/eval         <span class="token number">0</span>.011s

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面这个命令可以显示测试覆盖率工具的使用用法：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>$ go tool cover
Usage of &#39;go tool cover&#39;:
Given a coverage profile produced by &#39;go test&#39;:
    go test -coverprofile=c.out

Open a web browser displaying annotated source code:
    go tool cover -html=c.out
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>go tool</code>命令运行Go工具链的底层可执行程序。这些底层可执行程序放在 <code>$GOROOT/pkg/tool/${GOOS}_${GOARCH}</code> 目录。因为有<code>go build</code>命令的原因，我们很少直接调用这些底层工具。</p><hr><h2 id="ch11-4-基准测试" tabindex="-1"><a class="header-anchor" href="#ch11-4-基准测试"><span>CH11.4.基准测试</span></a></h2><p>基准测试是测量一个程序在固定工作负载下的性能。在Go语言中，基准测试函数和普通测试函数写法类似，但是以Benchmark为前缀名，并且带有一个<code>*testing.B</code>类型的参数；<code>*testing.B</code>参数除了提供和<code>*testing.T</code>类似的方法，还有额外一些和性能测量相关的方法。它还提供了一个整数N，用于指定操作执行的循环次数。</p><p>下面是IsPalindrome函数的基准测试，其中循环将执行N次。</p><hr><h3 id="ex11-6-为popcount函数编写基准测试" tabindex="-1"><a class="header-anchor" href="#ex11-6-为popcount函数编写基准测试"><span>EX11.6.为PopCount函数编写基准测试</span></a></h3><p><strong>练习 11.6:</strong> 为2.6.2节的练习2.4和练习2.5的PopCount函数编写基准测试。看看基于表格算法在不同情况下对提升性能会有多大帮助。</p><hr><h2 id="ch11-5-剖析" tabindex="-1"><a class="header-anchor" href="#ch11-5-剖析"><span>CH11.5.剖析</span></a></h2><hr><h2 id="ch11-6-示例函数" tabindex="-1"><a class="header-anchor" href="#ch11-6-示例函数"><span>CH11.6.示例函数</span></a></h2><hr></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/233Official/dailynotes/edit/main/docs/Language/Go/Go语言圣经/CH11-测试.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: ayusummer233@gmail.com">233</span>,<!--]--><!--[--><span class="contributor" title="email: ayusummer233@gmail.com">233JG</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH10-%E5%8C%85%E5%92%8C%E5%B7%A5%E5%85%B7.html" aria-label="CH10.包和工具"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->CH10.包和工具</div></a><a class="route-link nav-link next" href="/dailynotes/Language/Go/Go%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F/CH12-%E5%8F%8D%E5%B0%84.html" aria-label="CH12.反射"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">CH12.反射<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/dailynotes/assets/app-BT-bWAve.js" defer></script>
  </body>
</html>
